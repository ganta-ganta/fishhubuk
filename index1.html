<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>St. Margaret's Fish Bar - Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary-red: #d32f2f;
            --dark-red: #b71c1c;
            --light-red: #ff6659;
            --black: #121212;
            --dark-gray: #212121;
            --gray: #424242;
            --light-gray: #757575;
            --white: #ffffff;
            --off-white: #f5f5f5;
            --success: #4caf50;
            --warning: #ff9800;
            --info: #2196f3;
        }
        
        body {
            background-color: var(--black);
            color: var(--off-white);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header Styles */
        header {
            background-color: var(--black);
            color: var(--white);
            padding: 1.2rem 0;
            box-shadow: 0 3px 15px rgba(0,0,0,0.5);
            border-bottom: 3px solid var(--primary-red);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            font-size: 2.5rem;
            color: var(--primary-red);
        }
        
        .logo-text h1 {
            font-size: 1.6rem;
            margin-bottom: 5px;
            color: var(--white);
        }
        
        .logo-text p {
            color: var(--light-gray);
            font-size: 0.8rem;
            letter-spacing: 1px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-info span {
            color: var(--light-gray);
        }
        
        .logout-btn {
            background-color: var(--dark-gray);
            color: var(--white);
            padding: 8px 15px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .logout-btn:hover {
            background-color: var(--primary-red);
        }
        
        /* Navigation Tabs */
        .tabs {
            display: flex;
            background-color: var(--dark-gray);
            border-bottom: 2px solid var(--primary-red);
            overflow-x: auto;
        }
        
        .tab {
            padding: 15px 25px;
            background: none;
            border: none;
            color: var(--light-gray);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            border-right: 1px solid var(--gray);
        }
        
        .tab.active {
            background-color: var(--primary-red);
            color: var(--white);
        }
        
        .tab:hover:not(.active) {
            background-color: var(--gray);
            color: var(--white);
        }
        
        /* Main Content */
        .main-content {
            padding: 30px 0;
            min-height: calc(100vh - 180px);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Dashboard Cards */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background-color: var(--dark-gray);
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            border-left: 5px solid var(--primary-red);
        }
        
        .card h3 {
            font-size: 1rem;
            color: var(--light-gray);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .card .value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--white);
            margin-bottom: 5px;
        }
        
        .card .trend {
            font-size: 0.9rem;
        }
        
        .card .trend.up {
            color: var(--success);
        }
        
        .card .trend.down {
            color: var(--primary-red);
        }
        
        /* Charts Container */
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .chart-box {
            background-color: var(--dark-gray);
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .chart-box h3 {
            color: var(--white);
            margin-bottom: 20px;
            font-size: 1.3rem;
            border-bottom: 2px solid var(--primary-red);
            padding-bottom: 10px;
        }
        
        /* Tables */
        .table-container {
            background-color: var(--dark-gray);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            margin-bottom: 30px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background-color: var(--primary-red);
        }
        
        th {
            padding: 15px;
            text-align: left;
            color: var(--white);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        tbody tr {
            border-bottom: 1px solid var(--gray);
            transition: background-color 0.3s;
        }
        
        tbody tr:hover {
            background-color: var(--gray);
        }
        
        td {
            padding: 15px;
            color: var(--off-white);
        }
        
        /* Forms */
        .form-container {
            background-color: var(--dark-gray);
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            max-width: 800px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--white);
            font-weight: 600;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            background-color: var(--black);
            border: 1px solid var(--gray);
            border-radius: 5px;
            color: var(--white);
            font-size: 1rem;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-red);
        }
        
        .btn {
            padding: 12px 25px;
            background-color: var(--primary-red);
            color: var(--white);
            border: none;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
        }
        
        .btn:hover {
            background-color: var(--dark-red);
            box-shadow: 0 5px 15px rgba(211, 47, 47, 0.3);
        }
        
        .btn-secondary {
            background-color: var(--gray);
        }
        
        .btn-secondary:hover {
            background-color: var(--light-gray);
        }
        
        .btn-success {
            background-color: var(--success);
        }
        
        .btn-success:hover {
            background-color: #3d8b40;
        }
        
        .btn-warning {
            background-color: var(--warning);
        }
        
        .btn-warning:hover {
            background-color: #e68900;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 0.9rem;
        }
        
        /* Filters */
        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            padding: 20px;
            background-color: var(--dark-gray);
            border-radius: 8px;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            min-width: 200px;
        }
        
        /* Login Page */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(rgba(0,0,0,0.9), rgba(0,0,0,0.9)), url('https://images.unsplash.com/photo-1579208030886-b937da0925dc?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80');
            background-size: cover;
            background-position: center;
        }
        
        .login-box {
            background-color: var(--dark-gray);
            border-radius: 10px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
            border-top: 5px solid var(--primary-red);
        }
        
        .login-box h2 {
            text-align: center;
            color: var(--white);
            margin-bottom: 30px;
            font-size: 1.8rem;
        }
        
        /* Status Badges */
        .status-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-completed {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-preparing {
            background-color: #cce5ff;
            color: #004085;
        }
        
        /* Order Cards */
        .orders-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }
        
        .order-card {
            background-color: var(--dark-gray);
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            border-left: 5px solid var(--primary-red);
        }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray);
        }
        
        .order-id {
            font-weight: 700;
            color: var(--white);
            font-size: 1.2rem;
        }
        
        .order-time {
            color: var(--light-gray);
            font-size: 0.9rem;
        }
        
        .order-items {
            margin-bottom: 20px;
        }
        
        .order-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed var(--gray);
        }
        
        .order-total {
            display: flex;
            justify-content: space-between;
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--white);
            padding-top: 15px;
            border-top: 2px solid var(--gray);
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        /* Utility Classes */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .mt-20 { margin-top: 20px; }
        .mt-30 { margin-top: 30px; }
        .mb-20 { margin-bottom: 20px; }
        .mb-30 { margin-bottom: 30px; }
        .d-flex { display: flex; }
        .justify-between { justify-content: space-between; }
        .align-center { align-items: center; }
        .gap-10 { gap: 10px; }
        .gap-20 { gap: 20px; }
        
        /* Responsive Design */
        @media (max-width: 1100px) {
            .charts-container {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .tabs {
                overflow-x: scroll;
            }
            
            .tab {
                padding: 12px 15px;
                font-size: 0.9rem;
            }
            
            .dashboard-cards {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .card .value {
                font-size: 2rem;
            }
            
            .orders-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-box {
                padding: 15px;
            }
        }
        
        @media (max-width: 576px) {
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
            
            .filters {
                flex-direction: column;
            }
            
            .filter-group {
                min-width: 100%;
            }
            
            .action-buttons {
                flex-wrap: wrap;
            }
        }
        
        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--black);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-red);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--dark-red);
        }
    </style>
</head>
<body>
    <!-- Login Screen (Initial View) -->
    <div id="login-screen" class="login-container">
        <div class="login-box">
            <h2>St. Margaret's Fish Bar</h2>
            <h3 style="text-align: center; color: var(--light-gray); margin-bottom: 30px;">Management System Login</h3>
            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" class="form-control" placeholder="Enter admin username">
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" class="form-control" placeholder="Enter password">
            </div>
            <div class="form-group">
                <button id="login-btn" class="btn" style="width: 100%;">Login</button>
            </div>
            <p style="text-align: center; color: var(--light-gray); margin-top: 20px; font-size: 0.9rem;">
                Default admin credentials: Username: <strong>admin</strong> | Password: <strong>Admin@123</strong>
            </p>
        </div>
    </div>
    
    <!-- Main Application (Hidden until login) -->
    <div id="app" style="display: none;">
        <!-- Header -->
        <header>
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <div class="logo-icon">
                            <i class="fas fa-fish"></i>
                        </div>
                        <div class="logo-text">
                            <h1>ST. MARGARET'S FISH BAR</h1>
                            <p>MANAGEMENT SYSTEM</p>
                        </div>
                    </div>
                    
                    <div class="user-info">
                        <span id="current-user">Admin User</span>
                        <span id="current-date"></span>
                        <a href="#" id="logout-link" class="logout-btn">Logout</a>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Navigation Tabs -->
        <div class="tabs">
            <button class="tab active" data-tab="dashboard">Dashboard</button>
            <button class="tab" data-tab="orders">Orders</button>
            <button class="tab" data-tab="add-order">Add Order</button>
            <button class="tab" data-tab="staff">Staff Management</button>
            <button class="tab" data-tab="attendance">Attendance</button>
            <button class="tab" data-tab="payroll">Payroll</button>
            <button class="tab" data-tab="reports">Reports & Analytics</button>
            <button class="tab" data-tab="settings">Settings</button>
        </div>
        
        <!-- Main Content -->
        <div class="container main-content">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <h2 style="color: var(--white); margin-bottom: 30px; font-size: 1.8rem;">Dashboard Overview</h2>
                
                <!-- Dashboard Cards -->
                <div class="dashboard-cards">
                    <div class="card">
                        <h3>Today's Revenue</h3>
                        <div class="value" id="today-revenue">£0.00</div>
                        <div class="trend up" id="today-trend">+0% vs yesterday</div>
                    </div>
                    
                    <div class="card">
                        <h3>Monthly Revenue</h3>
                        <div class="value" id="month-revenue">£0.00</div>
                        <div class="trend up" id="month-trend">+0% vs last month</div>
                    </div>
                    
                    <div class="card">
                        <h3>Active Orders</h3>
                        <div class="value" id="active-orders">0</div>
                        <div class="trend">Pending: <span id="pending-orders">0</span></div>
                    </div>
                    
                    <div class="card">
                        <h3>Staff On Duty</h3>
                        <div class="value" id="staff-on-duty">0</div>
                        <div class="trend">Total Staff: <span id="total-staff">0</span></div>
                    </div>
                </div>
                
                <!-- Charts -->
                <div class="charts-container">
                    <div class="chart-box">
                        <h3>Revenue This Week</h3>
                        <canvas id="revenueChart"></canvas>
                    </div>
                    
                    <div class="chart-box">
                        <h3>Top Selling Items</h3>
                        <canvas id="salesChart"></canvas>
                    </div>
                </div>
                
                <!-- Recent Orders Table -->
                <div class="table-container">
                    <h3 style="padding: 20px; color: var(--white); border-bottom: 1px solid var(--gray);">Recent Orders</h3>
                    <table id="recent-orders-table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Type</th>
                                <th>Items</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Time</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Orders Tab -->
            <div id="orders" class="tab-content">
                <div class="d-flex justify-between align-center mb-30">
                    <h2 style="color: var(--white); font-size: 1.8rem;">Order Management</h2>
                    <div class="d-flex gap-10">
                        <button id="export-orders" class="btn btn-success">Export CSV</button>
                        <button id="import-orders" class="btn btn-secondary">Import CSV</button>
                    </div>
                </div>
                
                <!-- Filters -->
                <div class="filters">
                    <div class="filter-group">
                        <label>Date Range</label>
                        <input type="date" id="filter-date-from" class="form-control">
                    </div>
                    <div class="filter-group">
                        <label>To</label>
                        <input type="date" id="filter-date-to" class="form-control">
                    </div>
                    <div class="filter-group">
                        <label>Order Type</label>
                        <select id="filter-type" class="form-control">
                            <option value="all">All Types</option>
                            <option value="walk-in">Walk-in</option>
                            <option value="just-eat">Just Eat</option>
                            <option value="deliveroo">Deliveroo</option>
                            <option value="uber-eats">Uber Eats</option>
                            <option value="phone">Phone Order</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Status</label>
                        <select id="filter-status" class="form-control">
                            <option value="all">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="preparing">Preparing</option>
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                    <div class="filter-group d-flex align-center" style="align-self: flex-end;">
                        <button id="apply-filters" class="btn">Apply</button>
                        <button id="clear-filters" class="btn btn-secondary">Clear</button>
                    </div>
                </div>
                
                <!-- Order Cards -->
                <div class="orders-grid" id="orders-container">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Add Order Tab -->
            <div id="add-order" class="tab-content">
                <h2 style="color: var(--white); margin-bottom: 30px; font-size: 1.8rem;">Add New Order</h2>
                
                <div class="form-container">
                    <div class="form-group">
                        <label>Order Type</label>
                        <select id="order-type" class="form-control">
                            <option value="walk-in">Walk-in</option>
                            <option value="just-eat">Just Eat</option>
                            <option value="deliveroo">Deliveroo</option>
                            <option value="uber-eats">Uber Eats</option>
                            <option value="phone">Phone Order</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Customer Name</label>
                        <input type="text" id="customer-name" class="form-control" placeholder="Enter customer name">
                    </div>
                    
                    <div class="form-group">
                        <label>Customer Phone</label>
                        <input type="text" id="customer-phone" class="form-control" placeholder="Enter phone number">
                    </div>
                    
                    <div class="form-group">
                        <label>Select Items</label>
                        <div class="d-flex gap-10 mb-20" style="flex-wrap: wrap;">
                            <button class="btn btn-small btn-secondary" data-item="Cod" data-price="7.30">Cod (£7.30)</button>
                            <button class="btn btn-small btn-secondary" data-item="Haddock" data-price="8.30">Haddock (£8.30)</button>
                            <button class="btn btn-small btn-secondary" data-item="Chips" data-price="3.00">Chips (£3.00)</button>
                            <button class="btn btn-small btn-secondary" data-item="Jumbo Sausage" data-price="3.00">Jumbo Sausage (£3.00)</button>
                            <button class="btn btn-small btn-secondary" data-item="Pukka Pie" data-price="3.80">Pukka Pie (£3.80)</button>
                            <button class="btn btn-small btn-secondary" data-item="Mushy Peas" data-price="1.80">Mushy Peas (£1.80)</button>
                            <button class="btn btn-small btn-secondary" data-item="BBQ Chicken Half" data-price="5.50">BBQ Chicken Half (£5.50)</button>
                            <button class="btn btn-small btn-secondary" data-item="Kids Meal" data-price="7.95">Kids Meal (£7.95)</button>
                        </div>
                        <div id="selected-items" style="background-color: var(--black); padding: 15px; border-radius: 5px; min-height: 100px; margin-top: 10px;">
                            <p style="color: var(--light-gray); text-align: center;">No items selected yet</p>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Total Amount</label>
                        <input type="text" id="order-total" class="form-control" value="£0.00" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label>Payment Method</label>
                        <select id="payment-method" class="form-control">
                            <option value="cash">Cash</option>
                            <option value="card">Card</option>
                            <option value="just-eat">Just Eat</option>
                            <option value="deliveroo">Deliveroo</option>
                            <option value="uber-eats">Uber Eats</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Notes</label>
                        <textarea id="order-notes" class="form-control" rows="3" placeholder="Any special instructions or notes"></textarea>
                    </div>
                    
                    <div class="d-flex gap-10">
                        <button id="submit-order" class="btn">Submit Order</button>
                        <button id="clear-order" class="btn btn-secondary">Clear Form</button>
                    </div>
                </div>
            </div>
            
            <!-- Staff Management Tab -->
            <div id="staff" class="tab-content">
                <div class="d-flex justify-between align-center mb-30">
                    <h2 style="color: var(--white); font-size: 1.8rem;">Staff Management</h2>
                    <button id="add-staff-btn" class="btn">Add New Staff</button>
                </div>
                
                <div class="table-container">
                    <table id="staff-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Role</th>
                                <th>Contact</th>
                                <th>Hourly Rate</th>
                                <th>Hours This Week</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Attendance Tab -->
            <div id="attendance" class="tab-content">
                <h2 style="color: var(--white); margin-bottom: 30px; font-size: 1.8rem;">Attendance Tracking</h2>
                
                <div class="filters mb-30">
                    <div class="filter-group">
                        <label>Select Date</label>
                        <input type="date" id="attendance-date" class="form-control" value="">
                    </div>
                    <div class="filter-group">
                        <label>Select Staff</label>
                        <select id="attendance-staff" class="form-control">
                            <option value="all">All Staff</option>
                        </select>
                    </div>
                    <div class="filter-group d-flex align-center" style="align-self: flex-end;">
                        <button id="mark-attendance" class="btn">Mark Attendance</button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table id="attendance-table">
                        <thead>
                            <tr>
                                <th>Staff Name</th>
                                <th>Date</th>
                                <th>Shift Start</th>
                                <th>Shift End</th>
                                <th>Hours Worked</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Payroll Tab -->
            <div id="payroll" class="tab-content">
                <div class="d-flex justify-between align-center mb-30">
                    <h2 style="color: var(--white); font-size: 1.8rem;">Payroll Management</h2>
                    <div class="d-flex gap-10">
                        <button id="calculate-payroll" class="btn btn-success">Calculate Payroll</button>
                        <button id="export-payroll" class="btn">Export CSV</button>
                    </div>
                </div>
                
                <div class="filters mb-30">
                    <div class="filter-group">
                        <label>Pay Period</label>
                        <select id="pay-period" class="form-control">
                            <option value="this-week">This Week</option>
                            <option value="last-week">Last Week</option>
                            <option value="this-month">This Month</option>
                            <option value="last-month">Last Month</option>
                            <option value="custom">Custom Range</option>
                        </select>
                    </div>
                    <div class="filter-group" id="custom-date-range" style="display: none;">
                        <label>From</label>
                        <input type="date" id="pay-period-from" class="form-control">
                    </div>
                    <div class="filter-group" id="custom-date-range-to" style="display: none;">
                        <label>To</label>
                        <input type="date" id="pay-period-to" class="form-control">
                    </div>
                    <div class="filter-group d-flex align-center" style="align-self: flex-end;">
                        <button id="generate-payroll" class="btn">Generate</button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table id="payroll-table">
                        <thead>
                            <tr>
                                <th>Staff Name</th>
                                <th>Hours Worked</th>
                                <th>Hourly Rate</th>
                                <th>Gross Pay</th>
                                <th>Tax</th>
                                <th>NI</th>
                                <th>Net Pay</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <div class="card mt-30">
                    <h3>Payroll Summary</h3>
                    <div class="d-flex justify-between mt-20">
                        <div>
                            <p>Total Gross Pay: <span id="total-gross" style="font-weight: 700; color: var(--white);">£0.00</span></p>
                            <p>Total Tax: <span id="total-tax" style="color: var(--light-gray);">£0.00</span></p>
                            <p>Total NI: <span id="total-ni" style="color: var(--light-gray);">£0.00</span></p>
                        </div>
                        <div>
                            <h3 style="color: var(--white);">Total Net Pay</h3>
                            <div class="value" id="total-net">£0.00</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Reports Tab -->
            <div id="reports" class="tab-content">
                <h2 style="color: var(--white); margin-bottom: 30px; font-size: 1.8rem;">Reports & Analytics</h2>
                
                <div class="filters mb-30">
                    <div class="filter-group">
                        <label>Report Type</label>
                        <select id="report-type" class="form-control">
                            <option value="sales">Sales Report</option>
                            <option value="staff">Staff Performance</option>
                            <option value="inventory">Inventory Report</option>
                            <option value="financial">Financial Summary</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Date Range</label>
                        <select id="report-period" class="form-control">
                            <option value="today">Today</option>
                            <option value="yesterday">Yesterday</option>
                            <option value="this-week">This Week</option>
                            <option value="last-week">Last Week</option>
                            <option value="this-month">This Month</option>
                            <option value="last-month">Last Month</option>
                            <option value="custom">Custom Range</option>
                        </select>
                    </div>
                    <div class="filter-group" id="report-custom-range" style="display: none;">
                        <label>From</label>
                        <input type="date" id="report-from" class="form-control">
                    </div>
                    <div class="filter-group" id="report-custom-range-to" style="display: none;">
                        <label>To</label>
                        <input type="date" id="report-to" class="form-control">
                    </div>
                    <div class="filter-group d-flex align-center" style="align-self: flex-end;">
                        <button id="generate-report" class="btn">Generate Report</button>
                        <button id="export-report" class="btn btn-success">Export CSV</button>
                    </div>
                </div>
                
                <div class="charts-container">
                    <div class="chart-box">
                        <h3 id="report-chart-title">Sales Report</h3>
                        <canvas id="reportChart"></canvas>
                    </div>
                    
                    <div class="chart-box">
                        <h3>Data Summary</h3>
                        <div id="report-summary" style="padding: 20px;">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
                
                <div class="table-container mt-30">
                    <h3 style="padding: 20px; color: var(--white); border-bottom: 1px solid var(--gray);">Detailed Data</h3>
                    <table id="report-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Order Type</th>
                                <th>Items Sold</th>
                                <th>Revenue</th>
                                <th>Profit</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Settings Tab -->
            <div id="settings" class="tab-content">
                <h2 style="color: var(--white); margin-bottom: 30px; font-size: 1.8rem;">System Settings</h2>
                
                <div class="form-container">
                    <h3 style="color: var(--white); margin-bottom: 20px;">Menu Items & Pricing</h3>
                    
                    <div class="table-container mb-30">
                        <table id="menu-items-table">
                            <thead>
                                <tr>
                                    <th>Item Name</th>
                                    <th>Category</th>
                                    <th>Price</th>
                                    <th>Cost</th>
                                    <th>Profit Margin</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <h3 style="color: var(--white); margin-bottom: 20px;">System Configuration</h3>
                    
                    <div class="form-group">
                        <label>Business Name</label>
                        <input type="text" id="business-name" class="form-control" value="St. Margaret's Fish Bar">
                    </div>
                    
                    <div class="form-group">
                        <label>Tax Rate (%)</label>
                        <input type="number" id="tax-rate" class="form-control" value="20" step="0.1">
                    </div>
                    
                    <div class="form-group">
                        <label>Default Order Prefix</label>
                        <input type="text" id="order-prefix" class="form-control" value="SMFB">
                    </div>
                    
                    <div class="form-group">
                        <label>Auto-Archive Orders After (Days)</label>
                        <input type="number" id="archive-days" class="form-control" value="30">
                    </div>
                    
                    <div class="d-flex gap-10 mt-30">
                        <button id="save-settings" class="btn">Save Settings</button>
                        <button id="backup-data" class="btn btn-secondary">Backup Data</button>
                        <button id="restore-data" class="btn btn-warning">Restore Data</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Import CSV Modal -->
    <div id="import-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background-color: var(--dark-gray); padding: 30px; border-radius: 8px; width: 500px; max-width: 90%;">
            <h3 style="color: var(--white); margin-bottom: 20px;">Import CSV Data</h3>
            <div class="form-group">
                <label>Select CSV File</label>
                <input type="file" id="csv-file" class="form-control" accept=".csv">
            </div>
            <div class="form-group">
                <label>Data Type</label>
                <select id="import-type" class="form-control">
                    <option value="orders">Orders</option>
                    <option value="staff">Staff</option>
                    <option value="attendance">Attendance</option>
                </select>
            </div>
            <div class="d-flex gap-10 mt-20">
                <button id="confirm-import" class="btn btn-success">Import</button>
                <button id="cancel-import" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Add Staff Modal -->
    <div id="staff-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background-color: var(--dark-gray); padding: 30px; border-radius: 8px; width: 500px; max-width: 90%;">
            <h3 style="color: var(--white); margin-bottom: 20px;" id="modal-title">Add New Staff</h3>
            <div class="form-group">
                <label>Full Name</label>
                <input type="text" id="staff-name" class="form-control">
            </div>
            <div class="form-group">
                <label>Role</label>
                <select id="staff-role" class="form-control">
                    <option value="Manager">Manager</option>
                    <option value="Chef">Chef</option>
                    <option value="Server">Server</option>
                    <option value="Delivery">Delivery Driver</option>
                    <option value="Cleaner">Cleaner</option>
                </select>
            </div>
            <div class="form-group">
                <label>Phone Number</label>
                <input type="text" id="staff-phone" class="form-control">
            </div>
            <div class="form-group">
                <label>Email Address</label>
                <input type="email" id="staff-email" class="form-control">
            </div>
            <div class="form-group">
                <label>Hourly Rate (£)</label>
                <input type="number" id="staff-rate" class="form-control" step="0.01" min="0" value="10.50">
            </div>
            <div class="d-flex gap-10 mt-20">
                <button id="save-staff" class="btn">Save</button>
                <button id="cancel-staff" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let currentUser = null;
        let orders = [];
        let staff = [];
        let attendance = [];
        let menuItems = [];
        let settings = {};
        let selectedOrderItems = [];
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Set current date
            const now = new Date();
            document.getElementById('current-date').textContent = now.toLocaleDateString('en-GB', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            // Check if user is already logged in (from localStorage)
            const savedUser = localStorage.getItem('fishbar_user');
            if (savedUser) {
                try {
                    const userData = JSON.parse(savedUser);
                    if (userData.loggedIn && userData.timestamp > Date.now() - 24*60*60*1000) {
                        currentUser = userData.username;
                        showApp();
                        loadData();
                        initializeCharts();
                    }
                } catch(e) {
                    // Invalid saved data, show login
                }
            }
            
            // Login functionality
            document.getElementById('login-btn').addEventListener('click', function() {
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                if (username === 'admin' && password === 'Admin@123') {
                    currentUser = username;
                    
                    // Save login state
                    localStorage.setItem('fishbar_user', JSON.stringify({
                        username: username,
                        loggedIn: true,
                        timestamp: Date.now()
                    }));
                    
                    showApp();
                    loadData();
                    initializeCharts();
                } else {
                    alert('Invalid credentials! Please try again.\n\nDefault: Username: admin, Password: Admin@123');
                }
            });
            
            // Logout functionality
            document.getElementById('logout-link').addEventListener('click', function(e) {
                e.preventDefault();
                localStorage.removeItem('fishbar_user');
                location.reload();
            });
            
            // Tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Update active tab
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show corresponding content
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(tabId).classList.add('active');
                    
                    // Refresh data if needed
                    if (tabId === 'dashboard') {
                        updateDashboard();
                    } else if (tabId === 'orders') {
                        displayOrders();
                    } else if (tabId === 'staff') {
                        displayStaff();
                    } else if (tabId === 'attendance') {
                        displayAttendance();
                    } else if (tabId === 'payroll') {
                        displayPayroll();
                    }
                });
            });
            
            // Initialize event listeners
            initEventListeners();
            
            // Load sample data if no data exists
            if (!localStorage.getItem('fishbar_orders')) {
                loadSampleData();
            }
        });
        
        function showApp() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            document.getElementById('current-user').textContent = currentUser;
        }
        
        function loadData() {
            // Load orders from localStorage or initialize
            const savedOrders = localStorage.getItem('fishbar_orders');
            orders = savedOrders ? JSON.parse(savedOrders) : [];
            
            // Load staff from localStorage or initialize
            const savedStaff = localStorage.getItem('fishbar_staff');
            staff = savedStaff ? JSON.parse(savedStaff) : [];
            
            // Load attendance from localStorage or initialize
            const savedAttendance = localStorage.getItem('fishbar_attendance');
            attendance = savedAttendance ? JSON.parse(savedAttendance) : [];
            
            // Load menu items
            const savedMenu = localStorage.getItem('fishbar_menu');
            menuItems = savedMenu ? JSON.parse(savedMenu) : getDefaultMenuItems();
            
            // Load settings
            const savedSettings = localStorage.getItem('fishbar_settings');
            settings = savedSettings ? JSON.parse(savedSettings) : getDefaultSettings();
            
            // Update UI with loaded data
            updateDashboard();
            displayStaff();
            displayAttendance();
        }
        
        function saveData() {
            localStorage.setItem('fishbar_orders', JSON.stringify(orders));
            localStorage.setItem('fishbar_staff', JSON.stringify(staff));
            localStorage.setItem('fishbar_attendance', JSON.stringify(attendance));
            localStorage.setItem('fishbar_menu', JSON.stringify(menuItems));
            localStorage.setItem('fishbar_settings', JSON.stringify(settings));
        }
        
        function loadSampleData() {
            // Sample staff data
            staff = [
                { id: 1, name: "John Smith", role: "Manager", phone: "07123 456789", email: "john@fishbar.com", rate: 15.50, status: "active" },
                { id: 2, name: "Sarah Johnson", role: "Chef", phone: "07234 567890", email: "sarah@fishbar.com", rate: 12.75, status: "active" },
                { id: 3, name: "Mike Brown", role: "Server", phone: "07345 678901", email: "mike@fishbar.com", rate: 10.50, status: "active" },
                { id: 4, name: "Emma Wilson", role: "Delivery", phone: "07456 789012", email: "emma@fishbar.com", rate: 11.00, status: "active" }
            ];
            
            // Sample attendance data
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            attendance = [
                { id: 1, staffId: 1, date: formatDate(today), start: "09:00", end: "17:00", hours: 8, status: "present" },
                { id: 2, staffId: 2, date: formatDate(today), start: "10:00", end: "18:00", hours: 8, status: "present" },
                { id: 3, staffId: 3, date: formatDate(today), start: "12:00", end: "20:00", hours: 8, status: "present" },
                { id: 4, staffId: 1, date: formatDate(yesterday), start: "09:00", end: "17:00", hours: 8, status: "present" },
                { id: 5, staffId: 2, date: formatDate(yesterday), start: "10:00", end: "18:00", hours: 8, status: "present" }
            ];
            
            // Sample orders
            const orderDate = new Date();
            orders = [
                { 
                    id: "SMFB-001", 
                    type: "walk-in", 
                    customer: "David Miller", 
                    phone: "07567 890123",
                    items: [
                        { name: "Cod", price: 7.30, quantity: 1 },
                        { name: "Chips", price: 3.00, quantity: 1 },
                        { name: "Mushy Peas", price: 1.80, quantity: 1 }
                    ],
                    total: 12.10,
                    payment: "cash",
                    status: "completed",
                    timestamp: orderDate.toISOString(),
                    notes: ""
                },
                { 
                    id: "SMFB-002", 
                    type: "just-eat", 
                    customer: "Just Eat Customer", 
                    phone: "07678 901234",
                    items: [
                        { name: "Haddock", price: 8.30, quantity: 1 },
                        { name: "Chips", price: 3.00, quantity: 2 },
                        { name: "Jumbo Sausage", price: 3.00, quantity: 1 }
                    ],
                    total: 17.30,
                    payment: "just-eat",
                    status: "preparing",
                    timestamp: new Date(orderDate.getTime() - 30*60000).toISOString(),
                    notes: "Extra ketchup"
                },
                { 
                    id: "SMFB-003", 
                    type: "deliveroo", 
                    customer: "Deliveroo Customer", 
                    phone: "07789 012345",
                    items: [
                        { name: "BBQ Chicken Half", price: 5.50, quantity: 1 },
                        { name: "Chips", price: 3.00, quantity: 1 },
                        { name: "Onion Rings", price: 2.40, quantity: 1 }
                    ],
                    total: 10.90,
                    payment: "deliveroo",
                    status: "pending",
                    timestamp: new Date(orderDate.getTime() - 15*60000).toISOString(),
                    notes: "No salt on chips"
                }
            ];
            
            // Save sample data
            saveData();
        }
        
        function getDefaultMenuItems() {
            return [
                { name: "Cod", category: "Fish", price: 7.30, cost: 3.50 },
                { name: "Haddock", category: "Fish", price: 8.30, cost: 4.00 },
                { name: "Rock", category: "Fish", price: 7.80, cost: 3.80 },
                { name: "Plaice", category: "Fish", price: 7.80, cost: 3.80 },
                { name: "Skate", category: "Fish", price: 8.80, cost: 4.20 },
                { name: "Sea Bream", category: "Fish", price: 7.30, cost: 3.50 },
                { name: "Sea Bass", category: "Fish", price: 7.50, cost: 3.60 },
                { name: "Fish Cake", category: "Fish", price: 2.30, cost: 1.10 },
                { name: "Chips", category: "Fish", price: 3.00, cost: 0.80 },
                { name: "Jumbo Sausage", category: "Sausages", price: 3.00, cost: 1.20 },
                { name: "Battered Sausage", category: "Sausages", price: 3.30, cost: 1.30 },
                { name: "Saveloy", category: "Sausages", price: 3.00, cost: 1.20 },
                { name: "Pukka Pie", category: "Pies", price: 3.80, cost: 1.50 },
                { name: "Chicken & Mushroom", category: "Pies", price: 3.80, cost: 1.50 },
                { name: "Beef & Onion", category: "Pies", price: 3.80, cost: 1.50 },
                { name: "Steak & Kidney", category: "Pies", price: 3.80, cost: 1.50 },
                { name: "Plain Burger", category: "Burgers", price: 3.80, cost: 1.50 },
                { name: "Cheese Burger", category: "Burgers", price: 4.00, cost: 1.60 },
                { name: "Mushy Peas", category: "Sides", price: 1.80, cost: 0.50 },
                { name: "Curry Sauce", category: "Sides", price: 1.80, cost: 0.40 },
                { name: "Onion Rings", category: "Sides", price: 2.40, cost: 0.80 },
                { name: "Kids Meal", category: "Specials", price: 7.95, cost: 3.50 },
                { name: "BBQ Chicken Half", category: "BBQ Chicken", price: 5.50, cost: 2.50 },
                { name: "BBQ Chicken Whole", category: "BBQ Chicken", price: 8.50, cost: 3.80 }
            ];
        }
        
        function getDefaultSettings() {
            return {
                businessName: "St. Margaret's Fish Bar",
                taxRate: 20,
                orderPrefix: "SMFB",
                archiveDays: 30
            };
        }
        
        function initEventListeners() {
            // Order management
            document.getElementById('submit-order').addEventListener('click', submitOrder);
            document.getElementById('clear-order').addEventListener('click', clearOrderForm);
            
            // Item selection buttons
            document.querySelectorAll('[data-item]').forEach(button => {
                button.addEventListener('click', function() {
                    addItemToOrder(this.getAttribute('data-item'), parseFloat(this.getAttribute('data-price')));
                });
            });
            
            // Export/Import buttons
            document.getElementById('export-orders').addEventListener('click', exportOrdersToCSV);
            document.getElementById('import-orders').addEventListener('click', showImportModal);
            document.getElementById('cancel-import').addEventListener('click', hideImportModal);
            document.getElementById('confirm-import').addEventListener('click', importCSV);
            
            // Staff management
            document.getElementById('add-staff-btn').addEventListener('click', showStaffModal);
            document.getElementById('cancel-staff').addEventListener('click', hideStaffModal);
            document.getElementById('save-staff').addEventListener('click', saveStaffMember);
            
            // Attendance
            document.getElementById('mark-attendance').addEventListener('click', markAttendance);
            
            // Payroll
            document.getElementById('calculate-payroll').addEventListener('click', calculatePayroll);
            document.getElementById('generate-payroll').addEventListener('click', calculatePayroll);
            document.getElementById('export-payroll').addEventListener('click', exportPayrollToCSV);
            
            // Reports
            document.getElementById('generate-report').addEventListener('click', generateReport);
            document.getElementById('export-report').addEventListener('click', exportReportToCSV);
            
            // Settings
            document.getElementById('save-settings').addEventListener('click', saveSettings);
            document.getElementById('backup-data').addEventListener('click', backupData);
            document.getElementById('restore-data').addEventListener('click', restoreData);
            
            // Filters
            document.getElementById('apply-filters').addEventListener('click', applyOrderFilters);
            document.getElementById('clear-filters').addEventListener('click', clearOrderFilters);
            
            // Pay period selector
            document.getElementById('pay-period').addEventListener('change', function() {
                const isCustom = this.value === 'custom';
                document.getElementById('custom-date-range').style.display = isCustom ? 'block' : 'none';
                document.getElementById('custom-date-range-to').style.display = isCustom ? 'block' : 'none';
            });
            
            // Report period selector
            document.getElementById('report-period').addEventListener('change', function() {
                const isCustom = this.value === 'custom';
                document.getElementById('report-custom-range').style.display = isCustom ? 'block' : 'none';
                document.getElementById('report-custom-range-to').style.display = isCustom ? 'block' : 'none';
            });
        }
        
        function updateDashboard() {
            const today = new Date().toISOString().split('T')[0];
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = yesterday.toISOString().split('T')[0];
            
            // Calculate today's revenue
            const todayOrders = orders.filter(order => order.timestamp.split('T')[0] === today);
            const todayRevenue = todayOrders.reduce((sum, order) => sum + order.total, 0);
            document.getElementById('today-revenue').textContent = `£${todayRevenue.toFixed(2)}`;
            
            // Calculate yesterday's revenue for comparison
            const yesterdayOrders = orders.filter(order => order.timestamp.split('T')[0] === yesterdayStr);
            const yesterdayRevenue = yesterdayOrders.reduce((sum, order) => sum + order.total, 0);
            const todayTrend = yesterdayRevenue > 0 ? ((todayRevenue - yesterdayRevenue) / yesterdayRevenue * 100).toFixed(1) : 0;
            document.getElementById('today-trend').textContent = `${todayTrend >= 0 ? '+' : ''}${todayTrend}% vs yesterday`;
            document.getElementById('today-trend').className = `trend ${todayTrend >= 0 ? 'up' : 'down'}`;
            
            // Calculate monthly revenue
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            const monthOrders = orders.filter(order => {
                const orderDate = new Date(order.timestamp);
                return orderDate.getMonth() === currentMonth && orderDate.getFullYear() === currentYear;
            });
            const monthRevenue = monthOrders.reduce((sum, order) => sum + order.total, 0);
            document.getElementById('month-revenue').textContent = `£${monthRevenue.toFixed(2)}`;
            
            // Calculate last month's revenue for comparison
            const lastMonth = currentMonth === 0 ? 11 : currentMonth - 1;
            const lastMonthYear = currentMonth === 0 ? currentYear - 1 : currentYear;
            const lastMonthOrders = orders.filter(order => {
                const orderDate = new Date(order.timestamp);
                return orderDate.getMonth() === lastMonth && orderDate.getFullYear() === lastMonthYear;
            });
            const lastMonthRevenue = lastMonthOrders.reduce((sum, order) => sum + order.total, 0);
            const monthTrend = lastMonthRevenue > 0 ? ((monthRevenue - lastMonthRevenue) / lastMonthRevenue * 100).toFixed(1) : 0;
            document.getElementById('month-trend').textContent = `${monthTrend >= 0 ? '+' : ''}${monthTrend}% vs last month`;
            document.getElementById('month-trend').className = `trend ${monthTrend >= 0 ? 'up' : 'down'}`;
            
            // Active orders
            const activeOrders = orders.filter(order => order.status !== 'completed' && order.status !== 'cancelled');
            document.getElementById('active-orders').textContent = activeOrders.length;
            
            // Pending orders
            const pendingOrders = orders.filter(order => order.status === 'pending');
            document.getElementById('pending-orders').textContent = pendingOrders.length;
            
            // Staff on duty (today)
            const todayAttendance = attendance.filter(record => record.date === today && record.status === 'present');
            document.getElementById('staff-on-duty').textContent = todayAttendance.length;
            
            // Total staff
            const activeStaff = staff.filter(member => member.status === 'active');
            document.getElementById('total-staff').textContent = activeStaff.length;
            
            // Update recent orders table
            updateRecentOrdersTable();
        }
        
        function updateRecentOrdersTable() {
            const tableBody = document.getElementById('recent-orders-table').querySelector('tbody');
            tableBody.innerHTML = '';
            
            // Get recent orders (last 10)
            const recentOrders = [...orders]
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                .slice(0, 10);
            
            recentOrders.forEach(order => {
                const row = document.createElement('tr');
                const orderDate = new Date(order.timestamp);
                const timeString = orderDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                // Count total items
                const itemCount = order.items.reduce((sum, item) => sum + item.quantity, 0);
                
                row.innerHTML = `
                    <td>${order.id}</td>
                    <td>${order.customer}</td>
                    <td>${formatOrderType(order.type)}</td>
                    <td>${itemCount} items</td>
                    <td>£${order.total.toFixed(2)}</td>
                    <td><span class="status-badge status-${order.status}">${order.status}</span></td>
                    <td>${timeString}</td>
                `;
                
                tableBody.appendChild(row);
            });
        }
        
        function displayOrders() {
            const container = document.getElementById('orders-container');
            container.innerHTML = '';
            
            // Apply filters if any
            let filteredOrders = [...orders];
            
            const dateFrom = document.getElementById('filter-date-from').value;
            const dateTo = document.getElementById('filter-date-to').value;
            const typeFilter = document.getElementById('filter-type').value;
            const statusFilter = document.getElementById('filter-status').value;
            
            if (dateFrom) {
                filteredOrders = filteredOrders.filter(order => order.timestamp.split('T')[0] >= dateFrom);
            }
            
            if (dateTo) {
                filteredOrders = filteredOrders.filter(order => order.timestamp.split('T')[0] <= dateTo);
            }
            
            if (typeFilter !== 'all') {
                filteredOrders = filteredOrders.filter(order => order.type === typeFilter);
            }
            
            if (statusFilter !== 'all') {
                filteredOrders = filteredOrders.filter(order => order.status === statusFilter);
            }
            
            // Sort by most recent first
            filteredOrders.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            // Display orders as cards
            filteredOrders.forEach(order => {
                const orderCard = createOrderCard(order);
                container.appendChild(orderCard);
            });
            
            if (filteredOrders.length === 0) {
                container.innerHTML = '<div class="card" style="text-align: center; padding: 40px;"><h3>No orders found</h3><p>Try adjusting your filters</p></div>';
            }
        }
        
        function createOrderCard(order) {
            const card = document.createElement('div');
            card.className = 'order-card';
            
            const orderDate = new Date(order.timestamp);
            const dateString = orderDate.toLocaleDateString('en-GB');
            const timeString = orderDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            // Calculate item count
            const itemCount = order.items.reduce((sum, item) => sum + item.quantity, 0);
            
            // Create items HTML
            let itemsHTML = '';
            order.items.forEach(item => {
                itemsHTML += `
                    <div class="order-item">
                        <span>${item.quantity}x ${item.name}</span>
                        <span>£${(item.price * item.quantity).toFixed(2)}</span>
                    </div>
                `;
            });
            
            card.innerHTML = `
                <div class="order-header">
                    <div>
                        <div class="order-id">${order.id}</div>
                        <div class="order-time">${dateString} at ${timeString}</div>
                    </div>
                    <div>
                        <span class="status-badge status-${order.status}">${order.status}</span>
                    </div>
                </div>
                
                <div class="order-items">
                    <div style="margin-bottom: 10px;">
                        <strong>Customer:</strong> ${order.customer} (${order.phone})<br>
                        <strong>Type:</strong> ${formatOrderType(order.type)}<br>
                        <strong>Payment:</strong> ${formatPaymentMethod(order.payment)}
                    </div>
                    ${itemsHTML}
                </div>
                
                <div class="order-total">
                    <span>Total:</span>
                    <span>£${order.total.toFixed(2)}</span>
                </div>
                
                ${order.notes ? `<div style="margin-top: 15px; padding-top: 15px; border-top: 1px dashed var(--gray);"><strong>Notes:</strong> ${order.notes}</div>` : ''}
                
                <div class="action-buttons">
                    <button class="btn btn-small" onclick="updateOrderStatus('${order.id}', 'preparing')" ${order.status !== 'pending' ? 'disabled' : ''}>Start Preparing</button>
                    <button class="btn btn-small btn-success" onclick="updateOrderStatus('${order.id}', 'completed')" ${order.status === 'completed' ? 'disabled' : ''}>Complete</button>
                    <button class="btn btn-small btn-warning" onclick="updateOrderStatus('${order.id}', 'cancelled')">Cancel</button>
                    <button class="btn btn-small btn-secondary" onclick="deleteOrder('${order.id}')">Delete</button>
                </div>
            `;
            
            return card;
        }
        
        function addItemToOrder(itemName, price) {
            // Check if item already exists in order
            const existingItem = selectedOrderItems.find(item => item.name === itemName);
            
            if (existingItem) {
                existingItem.quantity++;
            } else {
                selectedOrderItems.push({
                    name: itemName,
                    price: price,
                    quantity: 1
                });
            }
            
            updateSelectedItemsDisplay();
        }
        
        function updateSelectedItemsDisplay() {
            const container = document.getElementById('selected-items');
            
            if (selectedOrderItems.length === 0) {
                container.innerHTML = '<p style="color: var(--light-gray); text-align: center;">No items selected yet</p>';
                document.getElementById('order-total').value = '£0.00';
                return;
            }
            
            let html = '';
            let total = 0;
            
            selectedOrderItems.forEach((item, index) => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                html += `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px dashed var(--gray);">
                        <div>
                            <strong>${item.quantity}x</strong> ${item.name}
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span>£${itemTotal.toFixed(2)}</span>
                            <button class="btn btn-small" style="padding: 2px 8px; font-size: 0.8rem;" onclick="removeItemFromOrder(${index})">Remove</button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            document.getElementById('order-total').value = `£${total.toFixed(2)}`;
        }
        
        function removeItemFromOrder(index) {
            selectedOrderItems.splice(index, 1);
            updateSelectedItemsDisplay();
        }
        
        function submitOrder() {
            const customerName = document.getElementById('customer-name').value;
            const customerPhone = document.getElementById('customer-phone').value;
            const orderType = document.getElementById('order-type').value;
            const paymentMethod = document.getElementById('payment-method').value;
            const notes = document.getElementById('order-notes').value;
            
            if (!customerName || !customerPhone) {
                alert('Please enter customer name and phone number');
                return;
            }
            
            if (selectedOrderItems.length === 0) {
                alert('Please add at least one item to the order');
                return;
            }
            
            // Generate order ID
            const orderId = generateOrderId();
            
            // Calculate total
            const total = selectedOrderItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            // Create order object
            const newOrder = {
                id: orderId,
                type: orderType,
                customer: customerName,
                phone: customerPhone,
                items: [...selectedOrderItems],
                total: total,
                payment: paymentMethod,
                status: 'pending',
                timestamp: new Date().toISOString(),
                notes: notes
            };
            
            // Add to orders array
            orders.unshift(newOrder);
            
            // Save data
            saveData();
            
            // Clear form
            clearOrderForm();
            
            // Show success message
            alert(`Order ${orderId} created successfully!`);
            
            // Switch to orders tab and refresh
            document.querySelector('[data-tab="orders"]').click();
            displayOrders();
            updateDashboard();
        }
        
        function clearOrderForm() {
            document.getElementById('customer-name').value = '';
            document.getElementById('customer-phone').value = '';
            document.getElementById('order-notes').value = '';
            selectedOrderItems = [];
            updateSelectedItemsDisplay();
        }
        
        function generateOrderId() {
            const prefix = settings.orderPrefix || 'SMFB';
            const today = new Date();
            const dateStr = today.getFullYear().toString().substr(-2) + 
                           (today.getMonth() + 1).toString().padStart(2, '0') + 
                           today.getDate().toString().padStart(2, '0');
            
            // Find highest order number for today
            const todayOrders = orders.filter(order => order.id.startsWith(prefix + '-' + dateStr));
            let maxNum = 0;
            
            todayOrders.forEach(order => {
                const num = parseInt(order.id.split('-').pop());
                if (num > maxNum) maxNum = num;
            });
            
            const nextNum = (maxNum + 1).toString().padStart(3, '0');
            return `${prefix}-${dateStr}-${nextNum}`;
        }
        
        function updateOrderStatus(orderId, newStatus) {
            const order = orders.find(o => o.id === orderId);
            if (order) {
                order.status = newStatus;
                saveData();
                displayOrders();
                updateDashboard();
                
                alert(`Order ${orderId} status updated to ${newStatus}`);
            }
        }
        
        function deleteOrder(orderId) {
            if (confirm(`Are you sure you want to delete order ${orderId}?`)) {
                const index = orders.findIndex(o => o.id === orderId);
                if (index !== -1) {
                    orders.splice(index, 1);
                    saveData();
                    displayOrders();
                    updateDashboard();
                    alert(`Order ${orderId} deleted`);
                }
            }
        }
        
        function applyOrderFilters() {
            displayOrders();
        }
        
        function clearOrderFilters() {
            document.getElementById('filter-date-from').value = '';
            document.getElementById('filter-date-to').value = '';
            document.getElementById('filter-type').value = 'all';
            document.getElementById('filter-status').value = 'all';
            displayOrders();
        }
        
        function exportOrdersToCSV() {
            // Create CSV content
            let csv = 'Order ID,Customer,Phone,Type,Items,Total,Payment,Status,Date,Time,Notes\n';
            
            orders.forEach(order => {
                const orderDate = new Date(order.timestamp);
                const dateStr = orderDate.toISOString().split('T')[0];
                const timeStr = orderDate.toTimeString().split(' ')[0];
                
                // Format items as string
                const itemsStr = order.items.map(item => `${item.quantity}x ${item.name}`).join('; ');
                
                // Escape commas and quotes in notes
                const notesEscaped = order.notes ? `"${order.notes.replace(/"/g, '""')}"` : '';
                
                csv += `"${order.id}","${order.customer}","${order.phone}","${order.type}","${itemsStr}",${order.total},"${order.payment}","${order.status}","${dateStr}","${timeStr}",${notesEscaped}\n`;
            });
            
            // Create download link
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `orders_export_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }
        
        function showImportModal() {
            document.getElementById('import-modal').style.display = 'flex';
        }
        
        function hideImportModal() {
            document.getElementById('import-modal').style.display = 'none';
        }
        
        function importCSV() {
            const fileInput = document.getElementById('csv-file');
            const importType = document.getElementById('import-type').value;
            
            if (!fileInput.files.length) {
                alert('Please select a CSV file to import');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const csvContent = e.target.result;
                    const rows = csvContent.split('\n').filter(row => row.trim() !== '');
                    
                    if (rows.length <= 1) {
                        alert('CSV file is empty or has no data rows');
                        return;
                    }
                    
                    // Parse CSV
                    const headers = rows[0].split(',').map(h => h.trim().replace(/"/g, ''));
                    const dataRows = rows.slice(1);
                    
                    let importedCount = 0;
                    
                    if (importType === 'orders') {
                        // Import orders
                        dataRows.forEach(row => {
                            const columns = parseCSVRow(row);
                            
                            if (columns.length >= headers.length) {
                                // Create order object from CSV row
                                const order = {
                                    id: columns[0] || generateOrderId(),
                                    customer: columns[1] || 'Unknown',
                                    phone: columns[2] || '',
                                    type: columns[3] || 'walk-in',
                                    items: parseItemsFromCSV(columns[4]),
                                    total: parseFloat(columns[5]) || 0,
                                    payment: columns[6] || 'cash',
                                    status: columns[7] || 'pending',
                                    timestamp: new Date(`${columns[8]}T${columns[9]}`).toISOString() || new Date().toISOString(),
                                    notes: columns[10] || ''
                                };
                                
                                orders.push(order);
                                importedCount++;
                            }
                        });
                    }
                    
                    saveData();
                    hideImportModal();
                    alert(`Successfully imported ${importedCount} ${importType} from CSV file`);
                    
                    // Refresh relevant views
                    if (importType === 'orders') {
                        displayOrders();
                        updateDashboard();
                    }
                    
                } catch (error) {
                    alert(`Error importing CSV: ${error.message}`);
                }
            };
            
            reader.readAsText(file);
        }
        
        function parseCSVRow(row) {
            // Simple CSV parser that handles quoted fields
            const result = [];
            let inQuotes = false;
            let currentField = '';
            
            for (let i = 0; i < row.length; i++) {
                const char = row[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(currentField);
                    currentField = '';
                } else {
                    currentField += char;
                }
            }
            
            result.push(currentField);
            return result.map(field => field.replace(/^"|"$/g, '').trim());
        }
        
        function parseItemsFromCSV(itemsStr) {
            // Parse items from format like "2x Cod; 1x Chips"
            const items = [];
            const itemParts = itemsStr.split(';');
            
            itemParts.forEach(part => {
                const match = part.trim().match(/^(\d+)x\s+(.+)$/);
                if (match) {
                    const quantity = parseInt(match[1]);
                    const name = match[2].trim();
                    
                    // Find price from menu items
                    const menuItem = menuItems.find(item => item.name === name);
                    const price = menuItem ? menuItem.price : 0;
                    
                    items.push({ name, price, quantity });
                }
            });
            
            return items;
        }
        
        function displayStaff() {
            const tableBody = document.getElementById('staff-table').querySelector('tbody');
            tableBody.innerHTML = '';
            
            // Populate staff dropdown in attendance
            const attendanceStaffSelect = document.getElementById('attendance-staff');
            attendanceStaffSelect.innerHTML = '<option value="all">All Staff</option>';
            
            staff.forEach(member => {
                if (member.status === 'active') {
                    // Add to table
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${member.id}</td>
                        <td>${member.name}</td>
                        <td>${member.role}</td>
                        <td>${member.phone}</td>
                        <td>£${member.rate.toFixed(2)}/hr</td>
                        <td>${calculateHoursThisWeek(member.id)}</td>
                        <td><span class="status-badge ${member.status === 'active' ? 'status-completed' : 'status-pending'}">${member.status}</span></td>
                        <td>
                            <button class="btn btn-small" onclick="editStaff(${member.id})">Edit</button>
                            <button class="btn btn-small btn-warning" onclick="toggleStaffStatus(${member.id})">${member.status === 'active' ? 'Deactivate' : 'Activate'}</button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                    
                    // Add to attendance dropdown
                    const option = document.createElement('option');
                    option.value = member.id;
                    option.textContent = member.name;
                    attendanceStaffSelect.appendChild(option);
                }
            });
        }
        
        function calculateHoursThisWeek(staffId) {
            const now = new Date();
            const startOfWeek = new Date(now);
            startOfWeek.setDate(now.getDate() - now.getDay()); // Sunday
            startOfWeek.setHours(0, 0, 0, 0);
            
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);
            endOfWeek.setHours(23, 59, 59, 999);
            
            const weekAttendance = attendance.filter(record => {
                return record.staffId === staffId && 
                       new Date(record.date) >= startOfWeek && 
                       new Date(record.date) <= endOfWeek &&
                       record.status === 'present';
            });
            
            const totalHours = weekAttendance.reduce((sum, record) => sum + record.hours, 0);
            return totalHours.toFixed(1);
        }
        
        function showStaffModal() {
            document.getElementById('modal-title').textContent = 'Add New Staff';
            document.getElementById('staff-name').value = '';
            document.getElementById('staff-role').value = 'Server';
            document.getElementById('staff-phone').value = '';
            document.getElementById('staff-email').value = '';
            document.getElementById('staff-rate').value = '10.50';
            document.getElementById('staff-modal').style.display = 'flex';
        }
        
        function hideStaffModal() {
            document.getElementById('staff-modal').style.display = 'none';
        }
        
        function saveStaffMember() {
            const name = document.getElementById('staff-name').value;
            const role = document.getElementById('staff-role').value;
            const phone = document.getElementById('staff-phone').value;
            const email = document.getElementById('staff-email').value;
            const rate = parseFloat(document.getElementById('staff-rate').value);
            
            if (!name || !phone) {
                alert('Please enter at least name and phone number');
                return;
            }
            
            // Generate new staff ID
            const newId = staff.length > 0 ? Math.max(...staff.map(s => s.id)) + 1 : 1;
            
            const newStaff = {
                id: newId,
                name: name,
                role: role,
                phone: phone,
                email: email,
                rate: rate,
                status: 'active'
            };
            
            staff.push(newStaff);
            saveData();
            hideStaffModal();
            displayStaff();
            
            alert(`Staff member ${name} added successfully`);
        }
        
        function editStaff(staffId) {
            const member = staff.find(s => s.id === staffId);
            if (!member) return;
            
            document.getElementById('modal-title').textContent = 'Edit Staff';
            document.getElementById('staff-name').value = member.name;
            document.getElementById('staff-role').value = member.role;
            document.getElementById('staff-phone').value = member.phone;
            document.getElementById('staff-email').value = member.email;
            document.getElementById('staff-rate').value = member.rate;
            
            // Temporarily store the staff ID for updating
            const saveBtn = document.getElementById('save-staff');
            saveBtn.dataset.editId = staffId;
            saveBtn.textContent = 'Update';
            
            // Change click handler for update
            saveBtn.onclick = updateStaffMember;
            
            document.getElementById('staff-modal').style.display = 'flex';
        }
        
        function updateStaffMember() {
            const staffId = parseInt(this.dataset.editId);
            const member = staff.find(s => s.id === staffId);
            
            if (member) {
                member.name = document.getElementById('staff-name').value;
                member.role = document.getElementById('staff-role').value;
                member.phone = document.getElementById('staff-phone').value;
                member.email = document.getElementById('staff-email').value;
                member.rate = parseFloat(document.getElementById('staff-rate').value);
                
                saveData();
                hideStaffModal();
                displayStaff();
                
                // Reset button
                const saveBtn = document.getElementById('save-staff');
                delete saveBtn.dataset.editId;
                saveBtn.textContent = 'Save';
                saveBtn.onclick = saveStaffMember;
                
                alert(`Staff member updated successfully`);
            }
        }
        
        function toggleStaffStatus(staffId) {
            const member = staff.find(s => s.id === staffId);
            if (member) {
                member.status = member.status === 'active' ? 'inactive' : 'active';
                saveData();
                displayStaff();
                
                alert(`Staff member ${member.name} ${member.status === 'active' ? 'activated' : 'deactivated'}`);
            }
        }
        
        function displayAttendance() {
            const tableBody = document.getElementById('attendance-table').querySelector('tbody');
            tableBody.innerHTML = '';
            
            // Set default date to today
            const dateInput = document.getElementById('attendance-date');
            if (!dateInput.value) {
                dateInput.value = formatDate(new Date());
            }
            
            // Filter attendance by date if specified
            const filterDate = dateInput.value;
            const filterStaff = document.getElementById('attendance-staff').value;
            
            let filteredAttendance = [...attendance];
            
            if (filterDate) {
                filteredAttendance = filteredAttendance.filter(record => record.date === filterDate);
            }
            
            if (filterStaff !== 'all') {
                filteredAttendance = filteredAttendance.filter(record => record.staffId === parseInt(filterStaff));
            }
            
            // Sort by staff name
            filteredAttendance.sort((a, b) => {
                const staffA = staff.find(s => s.id === a.staffId);
                const staffB = staff.find(s => s.id === b.staffId);
                return (staffA?.name || '').localeCompare(staffB?.name || '');
            });
            
            // Display attendance records
            filteredAttendance.forEach(record => {
                const staffMember = staff.find(s => s.id === record.staffId);
                if (!staffMember) return;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${staffMember.name}</td>
                    <td>${record.date}</td>
                    <td>${record.start}</td>
                    <td>${record.end}</td>
                    <td>${record.hours}</td>
                    <td><span class="status-badge ${record.status === 'present' ? 'status-completed' : 'status-pending'}">${record.status}</span></td>
                    <td>
                        <button class="btn btn-small" onclick="editAttendance(${record.id})">Edit</button>
                        <button class="btn btn-small btn-warning" onclick="deleteAttendance(${record.id})">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            if (filteredAttendance.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="7" style="text-align: center; padding: 30px;">No attendance records found for selected filters</td>`;
                tableBody.appendChild(row);
            }
        }
        
        function markAttendance() {
            const selectedDate = document.getElementById('attendance-date').value;
            const selectedStaff = document.getElementById('attendance-staff').value;
            
            if (!selectedDate) {
                alert('Please select a date');
                return;
            }
            
            if (selectedStaff === 'all') {
                // Mark attendance for all active staff
                const activeStaff = staff.filter(member => member.status === 'active');
                
                activeStaff.forEach(member => {
                    // Check if attendance already exists for this staff on this date
                    const existing = attendance.find(record => 
                        record.staffId === member.id && record.date === selectedDate
                    );
                    
                    if (!existing) {
                        // Create new attendance record
                        const newRecord = {
                            id: attendance.length > 0 ? Math.max(...attendance.map(a => a.id)) + 1 : 1,
                            staffId: member.id,
                            date: selectedDate,
                            start: '09:00',
                            end: '17:00',
                            hours: 8,
                            status: 'present'
                        };
                        
                        attendance.push(newRecord);
                    }
                });
                
                saveData();
                displayAttendance();
                alert(`Attendance marked for all active staff on ${selectedDate}`);
            } else {
                // Mark attendance for specific staff
                const staffId = parseInt(selectedStaff);
                const member = staff.find(s => s.id === staffId);
                
                if (!member) {
                    alert('Selected staff member not found');
                    return;
                }
                
                // Check if attendance already exists
                const existing = attendance.find(record => 
                    record.staffId === staffId && record.date === selectedDate
                );
                
                if (existing) {
                    alert(`Attendance for ${member.name} on ${selectedDate} already exists`);
                    return;
                }
                
                // Create new attendance record
                const newRecord = {
                    id: attendance.length > 0 ? Math.max(...attendance.map(a => a.id)) + 1 : 1,
                    staffId: staffId,
                    date: selectedDate,
                    start: '09:00',
                    end: '17:00',
                    hours: 8,
                    status: 'present'
                };
                
                attendance.push(newRecord);
                saveData();
                displayAttendance();
                
                alert(`Attendance marked for ${member.name} on ${selectedDate}`);
            }
        }
        
        function editAttendance(attendanceId) {
            const record = attendance.find(a => a.id === attendanceId);
            if (!record) return;
            
            const staffMember = staff.find(s => s.id === record.staffId);
            const newStart = prompt(`Enter start time for ${staffMember?.name || 'Staff'} on ${record.date}:`, record.start);
            const newEnd = prompt(`Enter end time:`, record.end);
            
            if (newStart && newEnd) {
                // Calculate hours
                const startHours = parseInt(newStart.split(':')[0]);
                const startMinutes = parseInt(newStart.split(':')[1]);
                const endHours = parseInt(newEnd.split(':')[0]);
                const endMinutes = parseInt(newEnd.split(':')[1]);
                
                const hours = (endHours + endMinutes/60) - (startHours + startMinutes/60);
                
                record.start = newStart;
                record.end = newEnd;
                record.hours = hours;
                
                saveData();
                displayAttendance();
                
                alert('Attendance record updated');
            }
        }
        
        function deleteAttendance(attendanceId) {
            if (confirm('Are you sure you want to delete this attendance record?')) {
                const index = attendance.findIndex(a => a.id === attendanceId);
                if (index !== -1) {
                    attendance.splice(index, 1);
                    saveData();
                    displayAttendance();
                    alert('Attendance record deleted');
                }
            }
        }
        
        function calculatePayroll() {
            const period = document.getElementById('pay-period').value;
            let startDate, endDate;
            
            const now = new Date();
            
            switch (period) {
                case 'this-week':
                    startDate = new Date(now);
                    startDate.setDate(now.getDate() - now.getDay()); // Sunday
                    endDate = new Date(startDate);
                    endDate.setDate(startDate.getDate() + 6);
                    break;
                    
                case 'last-week':
                    startDate = new Date(now);
                    startDate.setDate(now.getDate() - now.getDay() - 7);
                    endDate = new Date(startDate);
                    endDate.setDate(startDate.getDate() + 6);
                    break;
                    
                case 'this-month':
                    startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                    endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                    break;
                    
                case 'last-month':
                    startDate = new Date(now.getFullYear(), now.getMonth() - 1, 1);
                    endDate = new Date(now.getFullYear(), now.getMonth(), 0);
                    break;
                    
                case 'custom':
                    startDate = new Date(document.getElementById('pay-period-from').value);
                    endDate = new Date(document.getElementById('pay-period-to').value);
                    break;
                    
                default:
                    startDate = new Date(now);
                    startDate.setDate(now.getDate() - now.getDay());
                    endDate = new Date(startDate);
                    endDate.setDate(startDate.getDate() + 6);
            }
            
            startDate.setHours(0, 0, 0, 0);
            endDate.setHours(23, 59, 59, 999);
            
            // Calculate payroll for each staff
            const payrollData = [];
            let totalGross = 0;
            let totalTax = 0;
            let totalNI = 0;
            let totalNet = 0;
            
            staff.forEach(member => {
                if (member.status !== 'active') return;
                
                // Get attendance records for this period
                const periodAttendance = attendance.filter(record => {
                    const recordDate = new Date(record.date);
                    return record.staffId === member.id && 
                           recordDate >= startDate && 
                           recordDate <= endDate &&
                           record.status === 'present';
                });
                
                // Calculate hours worked
                const hoursWorked = periodAttendance.reduce((sum, record) => sum + record.hours, 0);
                
                if (hoursWorked > 0) {
                    // Calculate gross pay
                    const grossPay = hoursWorked * member.rate;
                    
                    // Calculate tax (simplified - 20% over £12,570 annual threshold)
                    const annualRate = member.rate * 40 * 52; // Assuming 40 hrs/week, 52 weeks/year
                    const taxFreeAllowance = 12570;
                    const taxableAnnual = Math.max(0, annualRate - taxFreeAllowance);
                    const taxRate = taxableAnnual > 0 ? 0.2 : 0;
                    
                    // Calculate tax for this period (pro-rata)
                    const daysInPeriod = (endDate - startDate) / (1000 * 60 * 60 * 24) + 1;
                    const tax = grossPay * taxRate * (daysInPeriod / 365) * 52;
                    
                    // Calculate NI (simplified - 12% over £242/week)
                    const weeklyRate = member.rate * 40;
                    const niThreshold = 242;
                    const niRate = weeklyRate > niThreshold ? 0.12 : 0;
                    const ni = grossPay * niRate * (daysInPeriod / 365) * 52;
                    
                    // Calculate net pay
                    const netPay = grossPay - tax - ni;
                    
                    payrollData.push({
                        staffName: member.name,
                        hoursWorked: hoursWorked.toFixed(1),
                        hourlyRate: member.rate,
                        grossPay: grossPay,
                        tax: tax,
                        ni: ni,
                        netPay: netPay,
                        status: 'pending'
                    });
                    
                    totalGross += grossPay;
                    totalTax += tax;
                    totalNI += ni;
                    totalNet += netPay;
                }
            });
            
            // Display payroll data
            displayPayrollTable(payrollData);
            
            // Update summary
            document.getElementById('total-gross').textContent = `£${totalGross.toFixed(2)}`;
            document.getElementById('total-tax').textContent = `£${totalTax.toFixed(2)}`;
            document.getElementById('total-ni').textContent = `£${totalNI.toFixed(2)}`;
            document.getElementById('total-net').textContent = `£${totalNet.toFixed(2)}`;
        }
        
        function displayPayrollTable(payrollData) {
            const tableBody = document.getElementById('payroll-table').querySelector('tbody');
            tableBody.innerHTML = '';
            
            payrollData.forEach(data => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${data.staffName}</td>
                    <td>${data.hoursWorked}</td>
                    <td>£${data.hourlyRate.toFixed(2)}</td>
                    <td>£${data.grossPay.toFixed(2)}</td>
                    <td>£${data.tax.toFixed(2)}</td>
                    <td>£${data.ni.toFixed(2)}</td>
                    <td>£${data.netPay.toFixed(2)}</td>
                    <td><span class="status-badge status-pending">${data.status}</span></td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function exportPayrollToCSV() {
            // Create CSV content
            let csv = 'Staff Name,Hours Worked,Hourly Rate,Gross Pay,Tax,NI,Net Pay,Status\n';
            
            const tableBody = document.getElementById('payroll-table').querySelector('tbody');
            const rows = tableBody.querySelectorAll('tr');
            
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length >= 8) {
                    const staffName = cells[0].textContent;
                    const hoursWorked = cells[1].textContent;
                    const hourlyRate = cells[2].textContent.replace('£', '');
                    const grossPay = cells[3].textContent.replace('£', '');
                    const tax = cells[4].textContent.replace('£', '');
                    const ni = cells[5].textContent.replace('£', '');
                    const netPay = cells[6].textContent.replace('£', '');
                    const status = cells[7].querySelector('.status-badge').textContent;
                    
                    csv += `"${staffName}",${hoursWorked},${hourlyRate},${grossPay},${tax},${ni},${netPay},"${status}"\n`;
                }
            });
            
            // Create download link
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `payroll_export_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }
        
        function generateReport() {
            const reportType = document.getElementById('report-type').value;
            const period = document.getElementById('report-period').value;
            
            let startDate, endDate;
            const now = new Date();
            
            switch (period) {
                case 'today':
                    startDate = new Date(now);
                    endDate = new Date(now);
                    break;
                    
                case 'yesterday':
                    startDate = new Date(now);
                    startDate.setDate(now.getDate() - 1);
                    endDate = new Date(startDate);
                    break;
                    
                case 'this-week':
                    startDate = new Date(now);
                    startDate.setDate(now.getDate() - now.getDay());
                    endDate = new Date(now);
                    break;
                    
                case 'last-week':
                    startDate = new Date(now);
                    startDate.setDate(now.getDate() - now.getDay() - 7);
                    endDate = new Date(startDate);
                    endDate.setDate(startDate.getDate() + 6);
                    break;
                    
                case 'this-month':
                    startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                    endDate = new Date(now);
                    break;
                    
                case 'last-month':
                    startDate = new Date(now.getFullYear(), now.getMonth() - 1, 1);
                    endDate = new Date(now.getFullYear(), now.getMonth(), 0);
                    break;
                    
                case 'custom':
                    startDate = new Date(document.getElementById('report-from').value);
                    endDate = new Date(document.getElementById('report-to').value);
                    break;
                    
                default:
                    startDate = new Date(now);
                    endDate = new Date(now);
            }
            
            startDate.setHours(0, 0, 0, 0);
            endDate.setHours(23, 59, 59, 999);
            
            // Filter orders by date range
            const filteredOrders = orders.filter(order => {
                const orderDate = new Date(order.timestamp);
                return orderDate >= startDate && orderDate <= endDate;
            });
            
            if (reportType === 'sales') {
                generateSalesReport(filteredOrders, startDate, endDate);
            } else if (reportType === 'financial') {
                generateFinancialReport(filteredOrders, startDate, endDate);
            }
        }
        
        function generateSalesReport(orders, startDate, endDate) {
            // Update chart title
            document.getElementById('report-chart-title').textContent = 'Sales by Order Type';
            
            // Calculate sales by order type
            const salesByType = {};
            orders.forEach(order => {
                const type = order.type;
                salesByType[type] = (salesByType[type] || 0) + order.total;
            });
            
            // Prepare data for chart
            const labels = Object.keys(salesByType).map(formatOrderType);
            const data = Object.values(salesByType);
            
            // Create chart
            const ctx = document.getElementById('reportChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (window.reportChartInstance) {
                window.reportChartInstance.destroy();
            }
            
            window.reportChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Sales (£)',
                        data: data,
                        backgroundColor: '#d32f2f',
                        borderColor: '#b71c1c',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '£' + value;
                                }
                            }
                        }
                    }
                }
            });
            
            // Update summary
            const totalSales = orders.reduce((sum, order) => sum + order.total, 0);
            const avgOrderValue = orders.length > 0 ? totalSales / orders.length : 0;
            const orderCount = orders.length;
            
            document.getElementById('report-summary').innerHTML = `
                <h4 style="color: var(--white); margin-bottom: 15px;">Sales Summary</h4>
                <p><strong>Date Range:</strong> ${startDate.toLocaleDateString()} to ${endDate.toLocaleDateString()}</p>
                <p><strong>Total Orders:</strong> ${orderCount}</p>
                <p><strong>Total Sales:</strong> £${totalSales.toFixed(2)}</p>
                <p><strong>Average Order Value:</strong> £${avgOrderValue.toFixed(2)}</p>
                <p><strong>Most Popular Type:</strong> ${getMostPopularOrderType(salesByType)}</p>
            `;
            
            // Update detailed data table
            updateReportTable(orders);
        }
        
        function generateFinancialReport(orders, startDate, endDate) {
            // Update chart title
            document.getElementById('report-chart-title').textContent = 'Daily Revenue';
            
            // Calculate daily revenue
            const dailyRevenue = {};
            orders.forEach(order => {
                const date = order.timestamp.split('T')[0];
                dailyRevenue[date] = (dailyRevenue[date] || 0) + order.total;
            });
            
            // Sort dates
            const sortedDates = Object.keys(dailyRevenue).sort();
            
            // Prepare data for chart
            const labels = sortedDates.map(date => {
                const d = new Date(date);
                return d.toLocaleDateString('en-GB', { weekday: 'short', day: 'numeric' });
            });
            const data = sortedDates.map(date => dailyRevenue[date]);
            
            // Create chart
            const ctx = document.getElementById('reportChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (window.reportChartInstance) {
                window.reportChartInstance.destroy();
            }
            
            window.reportChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Daily Revenue (£)',
                        data: data,
                        backgroundColor: 'rgba(211, 47, 47, 0.2)',
                        borderColor: '#d32f2f',
                        borderWidth: 2,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '£' + value;
                                }
                            }
                        }
                    }
                }
            });
            
            // Update summary
            const totalRevenue = orders.reduce((sum, order) => sum + order.total, 0);
            const orderCount = orders.length;
            const bestDay = getBestDay(dailyRevenue);
            
            document.getElementById('report-summary').innerHTML = `
                <h4 style="color: var(--white); margin-bottom: 15px;">Financial Summary</h4>
                <p><strong>Date Range:</strong> ${startDate.toLocaleDateString()} to ${endDate.toLocaleDateString()}</p>
                <p><strong>Total Revenue:</strong> £${totalRevenue.toFixed(2)}</p>
                <p><strong>Number of Orders:</strong> ${orderCount}</p>
                <p><strong>Best Day:</strong> ${bestDay.date} (£${bestDay.revenue.toFixed(2)})</p>
                <p><strong>Average Daily Revenue:</strong> £${(totalRevenue / Object.keys(dailyRevenue).length || 0).toFixed(2)}</p>
            `;
            
            // Update detailed data table
            updateReportTable(orders);
        }
        
        function getMostPopularOrderType(salesByType) {
            let maxType = '';
            let maxValue = 0;
            
            for (const [type, value] of Object.entries(salesByType)) {
                if (value > maxValue) {
                    maxValue = value;
                    maxType = formatOrderType(type);
                }
            }
            
            return maxType;
        }
        
        function getBestDay(dailyRevenue) {
            let bestDate = '';
            let bestRevenue = 0;
            
            for (const [date, revenue] of Object.entries(dailyRevenue)) {
                if (revenue > bestRevenue) {
                    bestRevenue = revenue;
                    bestDate = new Date(date).toLocaleDateString('en-GB');
                }
            }
            
            return { date: bestDate, revenue: bestRevenue };
        }
        
        function updateReportTable(orders) {
            const tableBody = document.getElementById('report-table').querySelector('tbody');
            tableBody.innerHTML = '';
            
            // Group orders by date
            const ordersByDate = {};
            orders.forEach(order => {
                const date = order.timestamp.split('T')[0];
                if (!ordersByDate[date]) {
                    ordersByDate[date] = [];
                }
                ordersByDate[date].push(order);
            });
            
            // Create table rows
            Object.keys(ordersByDate).sort().reverse().forEach(date => {
                const dateOrders = ordersByDate[date];
                const dateTotal = dateOrders.reduce((sum, order) => sum + order.total, 0);
                
                // Count items sold
                let itemsSold = 0;
                dateOrders.forEach(order => {
                    order.items.forEach(item => {
                        itemsSold += item.quantity;
                    });
                });
                
                // Group by order type
                const typeCount = {};
                dateOrders.forEach(order => {
                    typeCount[order.type] = (typeCount[order.type] || 0) + 1;
                });
                
                // Create type summary string
                const typeSummary = Object.entries(typeCount)
                    .map(([type, count]) => `${count} ${formatOrderType(type)}`)
                    .join(', ');
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(date).toLocaleDateString('en-GB')}</td>
                    <td>${typeSummary}</td>
                    <td>${itemsSold}</td>
                    <td>£${dateTotal.toFixed(2)}</td>
                    <td>£${(dateTotal * 0.6).toFixed(2)}</td> <!-- Estimated profit -->
                `;
                tableBody.appendChild(row);
            });
        }
        
        function exportReportToCSV() {
            // Create CSV from report table
            let csv = 'Date,Order Types,Items Sold,Revenue,Estimated Profit\n';
            
            const tableBody = document.getElementById('report-table').querySelector('tbody');
            const rows = tableBody.querySelectorAll('tr');
            
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length >= 5) {
                    const date = cells[0].textContent;
                    const orderTypes = `"${cells[1].textContent}"`;
                    const itemsSold = cells[2].textContent;
                    const revenue = cells[3].textContent.replace('£', '');
                    const profit = cells[4].textContent.replace('£', '');
                    
                    csv += `${date},${orderTypes},${itemsSold},${revenue},${profit}\n`;
                }
            });
            
            // Create download link
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `report_export_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }
        
        function saveSettings() {
            settings.businessName = document.getElementById('business-name').value;
            settings.taxRate = parseFloat(document.getElementById('tax-rate').value);
            settings.orderPrefix = document.getElementById('order-prefix').value;
            settings.archiveDays = parseInt(document.getElementById('archive-days').value);
            
            saveData();
            alert('Settings saved successfully');
        }
        
        function backupData() {
            const backup = {
                orders: orders,
                staff: staff,
                attendance: attendance,
                menuItems: menuItems,
                settings: settings,
                backupDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(backup, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `fishbar_backup_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            alert('Data backup created successfully');
        }
        
        function restoreData() {
            if (confirm('WARNING: This will replace all current data. Are you sure you want to restore from backup?')) {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                
                input.onchange = function(e) {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        try {
                            const backup = JSON.parse(e.target.result);
                            
                            // Validate backup structure
                            if (backup.orders && backup.staff && backup.settings) {
                                orders = backup.orders;
                                staff = backup.staff;
                                attendance = backup.attendance || [];
                                menuItems = backup.menuItems || getDefaultMenuItems();
                                settings = backup.settings;
                                
                                saveData();
                                location.reload();
                            } else {
                                alert('Invalid backup file format');
                            }
                        } catch (error) {
                            alert('Error reading backup file: ' + error.message);
                        }
                    };
                    
                    reader.readAsText(file);
                };
                
                input.click();
            }
        }
        
        function initializeCharts() {
            // Revenue chart for dashboard
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            
            // Sample data for revenue chart
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            const revenueData = days.map(() => Math.floor(Math.random() * 500) + 300);
            
            new Chart(revenueCtx, {
                type: 'line',
                data: {
                    labels: days,
                    datasets: [{
                        label: 'Daily Revenue (£)',
                        data: revenueData,
                        backgroundColor: 'rgba(211, 47, 47, 0.2)',
                        borderColor: '#d32f2f',
                        borderWidth: 2,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '£' + value;
                                }
                            }
                        }
                    }
                }
            });
            
            // Sales chart for dashboard
            const salesCtx = document.getElementById('salesChart').getContext('2d');
            
            // Calculate top selling items
            const itemSales = {};
            orders.forEach(order => {
                order.items.forEach(item => {
                    itemSales[item.name] = (itemSales[item.name] || 0) + item.quantity;
                });
            });
            
            // Get top 5 items
            const topItems = Object.entries(itemSales)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            const itemLabels = topItems.map(item => item[0]);
            const itemData = topItems.map(item => item[1]);
            
            new Chart(salesCtx, {
                type: 'doughnut',
                data: {
                    labels: itemLabels,
                    datasets: [{
                        label: 'Items Sold',
                        data: itemData,
                        backgroundColor: [
                            '#d32f2f',
                            '#ff6659',
                            '#b71c1c',
                            '#ff9a3c',
                            '#ffcc80'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }
        
        // Utility functions
        function formatDate(date) {
            const d = new Date(date);
            const year = d.getFullYear();
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        function formatOrderType(type) {
            const types = {
                'walk-in': 'Walk-in',
                'just-eat': 'Just Eat',
                'deliveroo': 'Deliveroo',
                'uber-eats': 'Uber Eats',
                'phone': 'Phone Order'
            };
            return types[type] || type;
        }
        
        function formatPaymentMethod(method) {
            const methods = {
                'cash': 'Cash',
                'card': 'Card',
                'just-eat': 'Just Eat',
                'deliveroo': 'Deliveroo',
                'uber-eats': 'Uber Eats'
            };
            return methods[method] || method;
        }
    </script>
</body>
</html>
