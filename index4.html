<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>St. Margaret's Fish Bar - Cloud Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary-red: #d32f2f;
            --dark-red: #b71c1c;
            --light-red: #ff6659;
            --black: #121212;
            --dark-gray: #212121;
            --gray: #424242;
            --light-gray: #757575;
            --white: #ffffff;
            --off-white: #f5f5f5;
            --success: #4caf50;
            --warning: #ff9800;
            --info: #2196f3;
            --kitchen-orange: #ff5722;
            --delivery-blue: #2196f3;
        }
        
        body {
            background-color: var(--black);
            color: var(--off-white);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header Styles */
        header {
            background-color: var(--black);
            color: var(--white);
            padding: 1.2rem 0;
            box-shadow: 0 3px 15px rgba(0,0,0,0.5);
            border-bottom: 3px solid var(--primary-red);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            font-size: 2.5rem;
            color: var(--primary-red);
        }
        
        .logo-text h1 {
            font-size: 1.6rem;
            margin-bottom: 5px;
            color: var(--white);
        }
        
        .logo-text p {
            color: var(--light-gray);
            font-size: 0.8rem;
            letter-spacing: 1px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-info span {
            color: var(--light-gray);
        }
        
        .logout-btn {
            background-color: var(--dark-gray);
            color: var(--white);
            padding: 8px 15px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .logout-btn:hover {
            background-color: var(--primary-red);
        }
        
        /* Navigation Tabs */
        .tabs {
            display: flex;
            background-color: var(--dark-gray);
            border-bottom: 2px solid var(--primary-red);
            overflow-x: auto;
        }
        
        .tab {
            padding: 15px 25px;
            background: none;
            border: none;
            color: var(--light-gray);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            border-right: 1px solid var(--gray);
        }
        
        .tab.active {
            background-color: var(--primary-red);
            color: var(--white);
        }
        
        .tab:hover:not(.active) {
            background-color: var(--gray);
            color: var(--white);
        }
        
        /* Sub Tabs */
        .sub-tabs {
            display: flex;
            background-color: var(--dark-gray);
            border-bottom: 1px solid var(--gray);
            margin-bottom: 20px;
            overflow-x: auto;
        }
        
        .sub-tab {
            padding: 12px 20px;
            background: none;
            border: none;
            color: var(--light-gray);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            border-right: 1px solid var(--gray);
        }
        
        .sub-tab.active {
            background-color: var(--gray);
            color: var(--white);
            border-bottom: 3px solid var(--primary-red);
        }
        
        .sub-tab:hover:not(.active) {
            background-color: var(--gray);
            color: var(--white);
        }
        
        /* Main Content */
        .main-content {
            padding: 30px 0;
            min-height: calc(100vh - 180px);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Dashboard Cards */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background-color: var(--dark-gray);
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            border-left: 5px solid var(--primary-red);
        }
        
        .card h3 {
            font-size: 1rem;
            color: var(--light-gray);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .card .value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--white);
            margin-bottom: 5px;
        }
        
        .card .trend {
            font-size: 0.9rem;
        }
        
        .card .trend.up {
            color: var(--success);
        }
        
        .card .trend.down {
            color: var(--primary-red);
        }
        
        /* Kitchen View Cards */
        .kitchen-orders-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }
        
        .kitchen-order-card {
            background-color: var(--dark-gray);
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            border-left: 5px solid var(--kitchen-orange);
            position: relative;
        }
        
        .kitchen-order-card.urgent {
            border-left: 5px solid var(--primary-red);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 87, 34, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 87, 34, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 87, 34, 0); }
        }
        
        .kitchen-order-card.completed {
            border-left: 5px solid var(--success);
        }
        
        .timer-display {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--kitchen-orange);
        }
        
        .timer-display.warning {
            color: var(--warning);
        }
        
        .timer-display.danger {
            color: var(--primary-red);
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Orders Grid */
        .orders-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }
        
        .order-card {
            background-color: var(--dark-gray);
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            border-left: 5px solid var(--primary-red);
        }
        
        .order-card.pending {
            border-left: 5px solid var(--warning);
        }
        
        .order-card.preparing {
            border-left: 5px solid var(--kitchen-orange);
        }
        
        .order-card.completed {
            border-left: 5px solid var(--success);
        }
        
        .order-card.delivery {
            border-left: 5px solid var(--delivery-blue);
        }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray);
        }
        
        .order-id {
            font-weight: 700;
            color: var(--white);
            font-size: 1.2rem;
        }
        
        .order-time {
            color: var(--light-gray);
            font-size: 0.9rem;
        }
        
        .order-items {
            margin-bottom: 20px;
        }
        
        .order-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed var(--gray);
        }
        
        .order-total {
            display: flex;
            justify-content: space-between;
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--white);
            padding-top: 15px;
            border-top: 2px solid var(--gray);
        }
        
        /* Charts Container */
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .chart-box {
            background-color: var(--dark-gray);
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .chart-box h3 {
            color: var(--white);
            margin-bottom: 20px;
            font-size: 1.3rem;
            border-bottom: 2px solid var(--primary-red);
            padding-bottom: 10px;
        }
        
        /* Tables */
        .table-container {
            background-color: var(--dark-gray);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            margin-bottom: 30px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background-color: var(--primary-red);
        }
        
        th {
            padding: 15px;
            text-align: left;
            color: var(--white);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        tbody tr {
            border-bottom: 1px solid var(--gray);
            transition: background-color 0.3s;
        }
        
        tbody tr:hover {
            background-color: var(--gray);
        }
        
        td {
            padding: 15px;
            color: var(--off-white);
        }
        
        /* Forms */
        .form-container {
            background-color: var(--dark-gray);
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            max-width: 800px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--white);
            font-weight: 600;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            background-color: var(--black);
            border: 1px solid var(--gray);
            border-radius: 5px;
            color: var(--white);
            font-size: 1rem;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-red);
        }
        
        .btn {
            padding: 12px 25px;
            background-color: var(--primary-red);
            color: var(--white);
            border: none;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
        }
        
        .btn:hover {
            background-color: var(--dark-red);
            box-shadow: 0 5px 15px rgba(211, 47, 47, 0.3);
        }
        
        .btn-secondary {
            background-color: var(--gray);
        }
        
        .btn-secondary:hover {
            background-color: var(--light-gray);
        }
        
        .btn-success {
            background-color: var(--success);
        }
        
        .btn-success:hover {
            background-color: #3d8b40;
        }
        
        .btn-warning {
            background-color: var(--warning);
        }
        
        .btn-warning:hover {
            background-color: #e68900;
        }
        
        .btn-info {
            background-color: var(--info);
        }
        
        .btn-info:hover {
            background-color: #0b7dda;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 0.9rem;
        }
        
        /* Filters */
        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            padding: 20px;
            background-color: var(--dark-gray);
            border-radius: 8px;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            min-width: 200px;
        }
        
        /* Login Page */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(rgba(0,0,0,0.9), rgba(0,0,0,0.9)), url('https://images.unsplash.com/photo-1579208030886-b937da0925dc?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80');
            background-size: cover;
            background-position: center;
        }
        
        .login-box {
            background-color: var(--dark-gray);
            border-radius: 10px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
            border-top: 5px solid var(--primary-red);
        }
        
        .login-box h2 {
            text-align: center;
            color: var(--white);
            margin-bottom: 30px;
            font-size: 1.8rem;
        }
        
        /* Status Badges */
        .status-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-preparing {
            background-color: #cce5ff;
            color: #004085;
        }
        
        .status-ready {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-completed {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-delivery {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        /* Utility Classes */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .mt-20 { margin-top: 20px; }
        .mt-30 { margin-top: 30px; }
        .mb-20 { margin-bottom: 20px; }
        .mb-30 { margin-bottom: 30px; }
        .d-flex { display: flex; }
        .justify-between { justify-content: space-between; }
        .align-center { align-items: center; }
        .gap-10 { gap: 10px; }
        .gap-20 { gap: 20px; }
        
        /* Auto-refresh Indicator */
        .auto-refresh-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            background-color: var(--success);
            border-radius: 50%;
            margin-left: 10px;
            animation: pulse 2s infinite;
        }
        
        /* Notification Sound Icon */
        .sound-toggle {
            cursor: pointer;
            color: var(--light-gray);
            transition: color 0.3s;
        }
        
        .sound-toggle.active {
            color: var(--success);
        }
        
        /* Responsive Design */
        @media (max-width: 1100px) {
            .charts-container {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .tabs {
                overflow-x: scroll;
            }
            
            .tab {
                padding: 12px 15px;
                font-size: 0.9rem;
            }
            
            .dashboard-cards {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .card .value {
                font-size: 2rem;
            }
            
            .orders-grid, .kitchen-orders-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-box {
                padding: 15px;
            }
            
            .sub-tabs {
                overflow-x: scroll;
            }
        }
        
        @media (max-width: 576px) {
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
            
            .filters {
                flex-direction: column;
            }
            
            .filter-group {
                min-width: 100%;
            }
            
            .action-buttons {
                flex-wrap: wrap;
            }
        }
        
        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--black);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-red);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--dark-red);
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: var(--dark-gray);
            padding: 30px;
            border-radius: 8px;
            width: 500px;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray);
        }
        
        .modal-title {
            color: var(--white);
            font-size: 1.5rem;
        }
        
        .close-modal {
            background: none;
            border: none;
            color: var(--light-gray);
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .close-modal:hover {
            color: var(--white);
        }
        
        /* Cooking Time Settings */
        .cooking-time-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--gray);
        }
        
        .cooking-time-name {
            flex: 1;
        }
        
        .cooking-time-input {
            width: 100px;
            padding: 8px;
            background-color: var(--black);
            border: 1px solid var(--gray);
            border-radius: 5px;
            color: var(--white);
        }
        
        /* Audio Notification */
        #notification-sound {
            display: none;
        }
        
        /* Connection Status */
        .connection-status {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        
        .connection-online {
            background-color: rgba(76, 175, 80, 0.2);
            color: var(--success);
        }
        
        .connection-offline {
            background-color: rgba(211, 47, 47, 0.2);
            color: var(--primary-red);
        }
        
        .connection-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .connection-online .connection-dot {
            background-color: var(--success);
            animation: pulse 2s infinite;
        }
        
        .connection-offline .connection-dot {
            background-color: var(--primary-red);
        }
    </style>
</head>
<body>
    <!-- Audio for notifications -->
    <audio id="notification-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-kitchen-timer-1006.mp3" type="audio/mpeg">
    </audio>
    
    <!-- Login Screen (Initial View) -->
    <div id="login-screen" class="login-container">
        <div class="login-box">
            <h2>St. Margaret's Fish Bar</h2>
            <h3 style="text-align: center; color: var(--light-gray); margin-bottom: 30px;">Cloud Management System</h3>
            <div class="form-group">
                <label for="username">Email</label>
                <input type="email" id="username" class="form-control" value="stfishhub@gmail.com" readonly>
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" class="form-control" value="password" readonly>
            </div>
            <div class="form-group">
                <button id="login-btn" class="btn" style="width: 100%;">
                    <i class="fas fa-cloud-upload-alt"></i> Connect to Cloud
                </button>
            </div>
            <div class="form-group" style="text-align: center;">
                <button id="offline-mode-btn" class="btn btn-secondary" style="width: 100%;">
                    <i class="fas fa-laptop"></i> Use Offline Mode
                </button>
            </div>
            <p style="text-align: center; color: var(--light-gray); margin-top: 20px; font-size: 0.9rem;">
                Email: <strong>stfishhub@gmail.com</strong> | Password: <strong>password</strong>
            </p>
            <div id="login-status" style="margin-top: 15px; padding: 10px; border-radius: 5px; display: none;"></div>
        </div>
    </div>
    
    <!-- Main Application (Hidden until login) -->
    <div id="app" style="display: none;">
        <!-- Header -->
        <header>
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <div class="logo-icon">
                            <i class="fas fa-fish"></i>
                        </div>
                        <div class="logo-text">
                            <h1>ST. MARGARET'S FISH BAR</h1>
                            <p>CLOUD MANAGEMENT SYSTEM</p>
                        </div>
                    </div>
                    
                    <div class="user-info">
                        <span id="current-user">stfishhub@gmail.com</span>
                        <span id="current-date"></span>
                        <span id="connection-status" class="connection-status connection-online">
                            <span class="connection-dot"></span>
                            <span class="connection-text">Online</span>
                        </span>
                        <i class="fas fa-bell sound-toggle" id="sound-toggle" title="Toggle notification sound"></i>
                        <a href="#" id="logout-link" class="logout-btn">Logout</a>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Navigation Tabs -->
        <div class="tabs">
            <button class="tab active" data-tab="dashboard">Dashboard</button>
            <button class="tab" data-tab="orders">Orders</button>
            <button class="tab" data-tab="kitchen">Kitchen View</button>
            <button class="tab" data-tab="staff">Staff Management</button>
            <button class="tab" data-tab="attendance">Attendance</button>
            <button class="tab" data-tab="payroll">Payroll</button>
            <button class="tab" data-tab="reports">Reports</button>
            <button class="tab" data-tab="settings">Settings</button>
        </div>
        
        <!-- Main Content -->
        <div class="container main-content">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <div class="d-flex justify-between align-center mb-30">
                    <h2 style="color: var(--white); font-size: 1.8rem;">Dashboard Overview</h2>
                    <div class="d-flex align-center">
                        <span style="color: var(--light-gray); margin-right: 10px;">Auto-refresh: 30s</span>
                        <div class="auto-refresh-indicator"></div>
                    </div>
                </div>
                
                <!-- Dashboard Cards -->
                <div class="dashboard-cards">
                    <div class="card">
                        <h3>Today's Revenue</h3>
                        <div class="value" id="today-revenue">£0.00</div>
                        <div class="trend up" id="today-trend">+0% vs yesterday</div>
                    </div>
                    
                    <div class="card">
                        <h3>Monthly Revenue</h3>
                        <div class="value" id="month-revenue">£0.00</div>
                        <div class="trend up" id="month-trend">+0% vs last month</div>
                    </div>
                    
                    <div class="card">
                        <h3>Active Orders</h3>
                        <div class="value" id="active-orders">0</div>
                        <div class="trend">Pending: <span id="pending-orders">0</span></div>
                    </div>
                    
                    <div class="card">
                        <h3>Kitchen Queue</h3>
                        <div class="value" id="kitchen-queue">0</div>
                        <div class="trend">Preparing: <span id="preparing-orders">0</span></div>
                    </div>
                </div>
                
                <!-- Charts -->
                <div class="charts-container">
                    <div class="chart-box">
                        <h3>Revenue This Week</h3>
                        <canvas id="revenueChart"></canvas>
                    </div>
                    
                    <div class="chart-box">
                        <h3>Top Selling Items</h3>
                        <canvas id="salesChart"></canvas>
                    </div>
                </div>
                
                <!-- Recent Orders Table -->
                <div class="table-container">
                    <div class="d-flex justify-between align-center" style="padding: 20px; border-bottom: 1px solid var(--gray);">
                        <h3 style="color: var(--white);">Recent Orders</h3>
                        <button id="refresh-dashboard" class="btn btn-small">Refresh Now</button>
                    </div>
                    <table id="recent-orders-table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Type</th>
                                <th>Items</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Time</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Orders Tab -->
            <div id="orders" class="tab-content">
                <!-- Sub Tabs for Orders -->
                <div class="sub-tabs">
                    <button class="sub-tab active" data-subtab="all-orders">All Orders</button>
                    <button class="sub-tab" data-subtab="new-order">New Order</button>
                    <button class="sub-tab" data-subtab="delivery">Delivery Orders</button>
                    <button class="sub-tab" data-subtab="takeaway">Takeaway Orders</button>
                </div>
                
                <!-- All Orders Sub Tab -->
                <div id="all-orders" class="sub-tab-content active">
                    <div class="d-flex justify-between align-center mb-30">
                        <h2 style="color: var(--white); font-size: 1.8rem;">Order Management</h2>
                        <div class="d-flex gap-10">
                            <button id="export-orders" class="btn btn-success">Export CSV</button>
                            <button id="import-orders" class="btn btn-secondary">Import CSV</button>
                            <button id="refresh-orders" class="btn">Refresh</button>
                        </div>
                    </div>
                    
                    <!-- Filters -->
                    <div class="filters">
                        <div class="filter-group">
                            <label>Date Range</label>
                            <input type="date" id="filter-date-from" class="form-control">
                        </div>
                        <div class="filter-group">
                            <label>To</label>
                            <input type="date" id="filter-date-to" class="form-control">
                        </div>
                        <div class="filter-group">
                            <label>Order Type</label>
                            <select id="filter-type" class="form-control">
                                <option value="all">All Types</option>
                                <option value="walk-in">Walk-in</option>
                                <option value="just-eat">Just Eat</option>
                                <option value="deliveroo">Deliveroo</option>
                                <option value="uber-eats">Uber Eats</option>
                                <option value="phone">Phone Order</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Status</label>
                            <select id="filter-status" class="form-control">
                                <option value="all">All Status</option>
                                <option value="pending">Pending</option>
                                <option value="preparing">Preparing</option>
                                <option value="ready">Ready</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                        <div class="filter-group d-flex align-center" style="align-self: flex-end;">
                            <button id="apply-filters" class="btn">Apply</button>
                            <button id="clear-filters" class="btn btn-secondary">Clear</button>
                        </div>
                    </div>
                    
                    <!-- Order Cards -->
                    <div class="orders-grid" id="orders-container">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
                
                <!-- New Order Sub Tab -->
                <div id="new-order" class="sub-tab-content">
                    <h2 style="color: var(--white); margin-bottom: 30px; font-size: 1.8rem;">Create New Order</h2>
                    
                    <div class="form-container">
                        <div class="form-group">
                            <label>Order Type</label>
                            <select id="order-type" class="form-control">
                                <option value="walk-in">Walk-in</option>
                                <option value="just-eat">Just Eat</option>
                                <option value="deliveroo">Deliveroo</option>
                                <option value="uber-eats">Uber Eats</option>
                                <option value="phone">Phone Order</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Customer Name</label>
                            <input type="text" id="customer-name" class="form-control" placeholder="Enter customer name">
                        </div>
                        
                        <div class="form-group">
                            <label>Customer Phone</label>
                            <input type="text" id="customer-phone" class="form-control" placeholder="Enter phone number">
                        </div>
                        
                        <div class="form-group">
                            <label>Delivery Address (if delivery)</label>
                            <textarea id="delivery-address" class="form-control" rows="2" placeholder="Enter delivery address"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Select Items</label>
                            <div class="d-flex gap-10 mb-20" style="flex-wrap: wrap;" id="menu-items-container">
                                <!-- Menu items will be populated by JavaScript -->
                            </div>
                            <div id="selected-items" style="background-color: var(--black); padding: 15px; border-radius: 5px; min-height: 100px; margin-top: 10px;">
                                <p style="color: var(--light-gray); text-align: center;">No items selected yet</p>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Total Amount</label>
                            <input type="text" id="order-total" class="form-control" value="£0.00" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label>Payment Method</label>
                            <select id="payment-method" class="form-control">
                                <option value="cash">Cash</option>
                                <option value="card">Card</option>
                                <option value="just-eat">Just Eat</option>
                                <option value="deliveroo">Deliveroo</option>
                                <option value="uber-eats">Uber Eats</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Notes/Instructions</label>
                            <textarea id="order-notes" class="form-control" rows="3" placeholder="Any special instructions or notes"></textarea>
                        </div>
                        
                        <div class="d-flex gap-10">
                            <button id="submit-order" class="btn">Submit Order</button>
                            <button id="clear-order" class="btn btn-secondary">Clear Form</button>
                        </div>
                    </div>
                </div>
                
                <!-- Delivery Orders Sub Tab -->
                <div id="delivery" class="sub-tab-content">
                    <h2 style="color: var(--white); margin-bottom: 30px; font-size: 1.8rem;">Delivery Orders</h2>
                    <div class="orders-grid" id="delivery-orders-container">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
                
                <!-- Takeaway Orders Sub Tab -->
                <div id="takeaway" class="sub-tab-content">
                    <h2 style="color: var(--white); margin-bottom: 30px; font-size: 1.8rem;">Takeaway Orders</h2>
                    <div class="orders-grid" id="takeaway-orders-container">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- Kitchen View Tab -->
            <div id="kitchen" class="tab-content">
                <div class="d-flex justify-between align-center mb-30">
                    <h2 style="color: var(--white); font-size: 1.8rem;">Kitchen Management</h2>
                    <div class="d-flex gap-10">
                        <button id="refresh-kitchen" class="btn">Refresh Kitchen View</button>
                        <button id="kitchen-settings" class="btn btn-secondary">Kitchen Settings</button>
                    </div>
                </div>
                
                <!-- Kitchen Stats -->
                <div class="dashboard-cards mb-30">
                    <div class="card">
                        <h3>Orders Preparing</h3>
                        <div class="value" id="preparing-count">0</div>
                        <div class="trend">Avg Time: <span id="avg-prep-time">0m</span></div>
                    </div>
                    
                    <div class="card">
                        <h3>Orders Ready</h3>
                        <div class="value" id="ready-count">0</div>
                        <div class="trend">Waiting: <span id="waiting-count">0</span></div>
                    </div>
                    
                    <div class="card">
                        <h3>Urgent Orders</h3>
                        <div class="value" id="urgent-count">0</div>
                        <div class="trend">Overdue: <span id="overdue-count">0</span></div>
                    </div>
                    
                    <div class="card">
                        <h3>Kitchen Efficiency</h3>
                        <div class="value" id="efficiency-rate">0%</div>
                        <div class="trend">Today: <span id="today-completed">0</span> orders</div>
                    </div>
                </div>
                
                <!-- Kitchen Orders Grid -->
                <div class="kitchen-orders-grid" id="kitchen-orders-container">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Staff Management Tab -->
            <div id="staff" class="tab-content">
                <div class="d-flex justify-between align-center mb-30">
                    <h2 style="color: var(--white); font-size: 1.8rem;">Staff Management</h2>
                    <button id="add-staff-btn" class="btn">Add New Staff</button>
                </div>
                
                <div class="table-container">
                    <table id="staff-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Role</th>
                                <th>Contact</th>
                                <th>Hourly Rate</th>
                                <th>Hours This Week</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Attendance Tab -->
            <div id="attendance" class="tab-content">
                <h2 style="color: var(--white); margin-bottom: 30px; font-size: 1.8rem;">Attendance Tracking</h2>
                
                <div class="filters mb-30">
                    <div class="filter-group">
                        <label>Select Date</label>
                        <input type="date" id="attendance-date" class="form-control" value="">
                    </div>
                    <div class="filter-group">
                        <label>Select Staff</label>
                        <select id="attendance-staff" class="form-control">
                            <option value="all">All Staff</option>
                        </select>
                    </div>
                    <div class="filter-group d-flex align-center" style="align-self: flex-end;">
                        <button id="mark-attendance" class="btn">Mark Attendance</button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table id="attendance-table">
                        <thead>
                            <tr>
                                <th>Staff Name</th>
                                <th>Date</th>
                                <th>Shift Start</th>
                                <th>Shift End</th>
                                <th>Hours Worked</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Payroll Tab -->
            <div id="payroll" class="tab-content">
                <div class="d-flex justify-between align-center mb-30">
                    <h2 style="color: var(--white); font-size: 1.8rem;">Payroll Management</h2>
                    <div class="d-flex gap-10">
                        <button id="calculate-payroll" class="btn btn-success">Calculate Payroll</button>
                        <button id="export-payroll" class="btn">Export CSV</button>
                    </div>
                </div>
                
                <div class="filters mb-30">
                    <div class="filter-group">
                        <label>Pay Period</label>
                        <select id="pay-period" class="form-control">
                            <option value="this-week">This Week</option>
                            <option value="last-week">Last Week</option>
                            <option value="this-month">This Month</option>
                            <option value="last-month">Last Month</option>
                            <option value="custom">Custom Range</option>
                        </select>
                    </div>
                    <div class="filter-group" id="custom-date-range" style="display: none;">
                        <label>From</label>
                        <input type="date" id="pay-period-from" class="form-control">
                    </div>
                    <div class="filter-group" id="custom-date-range-to" style="display: none;">
                        <label>To</label>
                        <input type="date" id="pay-period-to" class="form-control">
                    </div>
                    <div class="filter-group d-flex align-center" style="align-self: flex-end;">
                        <button id="generate-payroll" class="btn">Generate</button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table id="payroll-table">
                        <thead>
                            <tr>
                                <th>Staff Name</th>
                                <th>Hours Worked</th>
                                <th>Hourly Rate</th>
                                <th>Gross Pay</th>
                                <th>Tax</th>
                                <th>NI</th>
                                <th>Net Pay</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <div class="card mt-30">
                    <h3>Payroll Summary</h3>
                    <div class="d-flex justify-between mt-20">
                        <div>
                            <p>Total Gross Pay: <span id="total-gross" style="font-weight: 700; color: var(--white);">£0.00</span></p>
                            <p>Total Tax: <span id="total-tax" style="color: var(--light-gray);">£0.00</span></p>
                            <p>Total NI: <span id="total-ni" style="color: var(--light-gray);">£0.00</span></p>
                        </div>
                        <div>
                            <h3 style="color: var(--white);">Total Net Pay</h3>
                            <div class="value" id="total-net">£0.00</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Reports Tab -->
            <div id="reports" class="tab-content">
                <h2 style="color: var(--white); margin-bottom: 30px; font-size: 1.8rem;">Reports & Analytics</h2>
                
                <div class="filters mb-30">
                    <div class="filter-group">
                        <label>Report Type</label>
                        <select id="report-type" class="form-control">
                            <option value="sales">Sales Report</option>
                            <option value="staff">Staff Performance</option>
                            <option value="inventory">Inventory Report</option>
                            <option value="financial">Financial Summary</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Date Range</label>
                        <select id="report-period" class="form-control">
                            <option value="today">Today</option>
                            <option value="yesterday">Yesterday</option>
                            <option value="this-week">This Week</option>
                            <option value="last-week">Last Week</option>
                            <option value="this-month">This Month</option>
                            <option value="last-month">Last Month</option>
                            <option value="custom">Custom Range</option>
                        </select>
                    </div>
                    <div class="filter-group" id="report-custom-range" style="display: none;">
                        <label>From</label>
                        <input type="date" id="report-from" class="form-control">
                    </div>
                    <div class="filter-group" id="report-custom-range-to" style="display: none;">
                        <label>To</label>
                        <input type="date" id="report-to" class="form-control">
                    </div>
                    <div class="filter-group d-flex align-center" style="align-self: flex-end;">
                        <button id="generate-report" class="btn">Generate Report</button>
                        <button id="export-report" class="btn btn-success">Export CSV</button>
                    </div>
                </div>
                
                <div class="charts-container">
                    <div class="chart-box">
                        <h3 id="report-chart-title">Sales Report</h3>
                        <canvas id="reportChart"></canvas>
                    </div>
                    
                    <div class="chart-box">
                        <h3>Data Summary</h3>
                        <div id="report-summary" style="padding: 20px;">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
                
                <div class="table-container mt-30">
                    <h3 style="padding: 20px; color: var(--white); border-bottom: 1px solid var(--gray);">Detailed Data</h3>
                    <table id="report-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Order Type</th>
                                <th>Items Sold</th>
                                <th>Revenue</th>
                                <th>Profit</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Settings Tab -->
            <div id="settings" class="tab-content">
                <!-- Sub Tabs for Settings -->
                <div class="sub-tabs">
                    <button class="sub-tab active" data-subtab="business-settings">Business Settings</button>
                    <button class="sub-tab" data-subtab="menu-settings">Menu Settings</button>
                    <button class="sub-tab" data-subtab="kitchen-settings-tab">Kitchen Settings</button>
                    <button class="sub-tab" data-subtab="system-settings">System Settings</button>
                </div>
                
                <!-- Business Settings Sub Tab -->
                <div id="business-settings" class="sub-tab-content active">
                    <h2 style="color: var(--white); margin-bottom: 30px; font-size: 1.8rem;">Business Settings</h2>
                    
                    <div class="form-container">
                        <div class="form-group">
                            <label>Business Name</label>
                            <input type="text" id="business-name" class="form-control" value="St. Margaret's Fish Bar">
                        </div>
                        
                        <div class="form-group">
                            <label>Business Address</label>
                            <textarea id="business-address" class="form-control" rows="3" placeholder="Enter business address"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Business Phone</label>
                            <input type="text" id="business-phone" class="form-control" placeholder="Enter business phone number">
                        </div>
                        
                        <div class="form-group">
                            <label>Business Email</label>
                            <input type="email" id="business-email" class="form-control" placeholder="Enter business email">
                        </div>
                        
                        <div class="form-group">
                            <label>Tax Rate (%)</label>
                            <input type="number" id="tax-rate" class="form-control" value="20" step="0.1" min="0" max="100">
                        </div>
                        
                        <div class="form-group">
                            <label>Service Charge (%)</label>
                            <input type="number" id="service-charge" class="form-control" value="0" step="0.1" min="0" max="20">
                        </div>
                        
                        <div class="d-flex gap-10 mt-30">
                            <button id="save-business-settings" class="btn">Save Business Settings</button>
                        </div>
                    </div>
                </div>
                
                <!-- Menu Settings Sub Tab -->
                <div id="menu-settings" class="sub-tab-content">
                    <div class="d-flex justify-between align-center mb-30">
                        <h2 style="color: var(--white); font-size: 1.8rem;">Menu Items & Pricing</h2>
                        <button id="add-menu-item" class="btn">Add Menu Item</button>
                    </div>
                    
                    <div class="table-container">
                        <table id="menu-items-table">
                            <thead>
                                <tr>
                                    <th>Item Name</th>
                                    <th>Category</th>
                                    <th>Price (£)</th>
                                    <th>Cost (£)</th>
                                    <th>Profit Margin</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Kitchen Settings Sub Tab -->
                <div id="kitchen-settings-tab" class="sub-tab-content">
                    <h2 style="color: var(--white); margin-bottom: 30px; font-size: 1.8rem;">Kitchen Settings</h2>
                    
                    <div class="form-container">
                        <div class="form-group">
                            <label>Default Cooking Times (Minutes)</label>
                            <div id="cooking-times-container">
                                <!-- Will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Alert Before Cooking Time Ends (Minutes)</label>
                            <input type="number" id="alert-before-time" class="form-control" value="5" min="1" max="30">
                        </div>
                        
                        <div class="form-group">
                            <label>Urgent Order Threshold (Minutes)</label>
                            <input type="number" id="urgent-threshold" class="form-control" value="10" min="1" max="60">
                        </div>
                        
                        <div class="form-group">
                            <label>Auto-refresh Kitchen View (Seconds)</label>
                            <input type="number" id="kitchen-refresh-rate" class="form-control" value="30" min="5" max="120">
                        </div>
                        
                        <div class="form-group">
                            <label>Enable Sound Notifications</label>
                            <div>
                                <input type="checkbox" id="enable-sound" checked> <label for="enable-sound">Play sound when order is ready or overdue</label>
                            </div>
                        </div>
                        
                        <div class="d-flex gap-10 mt-30">
                            <button id="save-kitchen-settings" class="btn">Save Kitchen Settings</button>
                        </div>
                    </div>
                </div>
                
                <!-- System Settings Sub Tab -->
                <div id="system-settings" class="sub-tab-content">
                    <h2 style="color: var(--white); margin-bottom: 30px; font-size: 1.8rem;">System Settings</h2>
                    
                    <div class="form-container">
                        <div class="form-group">
                            <label>Default Order Prefix</label>
                            <input type="text" id="order-prefix" class="form-control" value="SMFB">
                        </div>
                        
                        <div class="form-group">
                            <label>Auto-Archive Orders After (Days)</label>
                            <input type="number" id="archive-days" class="form-control" value="30" min="1" max="365">
                        </div>
                        
                        <div class="form-group">
                            <label>Dashboard Auto-refresh (Seconds)</label>
                            <input type="number" id="dashboard-refresh-rate" class="form-control" value="30" min="10" max="300">
                        </div>
                        
                        <div class="form-group">
                            <label>Default Date Format</label>
                            <select id="date-format" class="form-control">
                                <option value="dd/mm/yyyy">DD/MM/YYYY</option>
                                <option value="mm/dd/yyyy">MM/DD/YYYY</option>
                                <option value="yyyy-mm-dd">YYYY-MM-DD</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Default Time Format</label>
                            <select id="time-format" class="form-control">
                                <option value="12h">12-hour (AM/PM)</option>
                                <option value="24h">24-hour</option>
                            </select>
                        </div>
                        
                        <h3 style="color: var(--white); margin: 30px 0 15px;">Data Management</h3>
                        
                        <div class="d-flex gap-10">
                            <button id="backup-data" class="btn btn-secondary">Backup All Data</button>
                            <button id="restore-data" class="btn btn-warning">Restore From Backup</button>
                            <button id="clear-all-data" class="btn" style="background-color: #dc3545;">Clear All Data</button>
                        </div>
                        
                        <div class="d-flex gap-10 mt-30">
                            <button id="save-system-settings" class="btn">Save System Settings</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modals -->
    
    <!-- Add/Edit Staff Modal -->
    <div id="staff-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">Add New Staff</h3>
                <button class="close-modal" id="close-staff-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="staff-name" class="form-control">
                </div>
                <div class="form-group">
                    <label>Role</label>
                    <select id="staff-role" class="form-control">
                        <option value="Manager">Manager</option>
                        <option value="Head Chef">Head Chef</option>
                        <option value="Chef">Chef</option>
                        <option value="Kitchen Assistant">Kitchen Assistant</option>
                        <option value="Server">Server</option>
                        <option value="Delivery Driver">Delivery Driver</option>
                        <option value="Cleaner">Cleaner</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="text" id="staff-phone" class="form-control">
                </div>
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="staff-email" class="form-control">
                </div>
                <div class="form-group">
                    <label>Hourly Rate (£)</label>
                    <input type="number" id="staff-rate" class="form-control" step="0.01" min="0" value="10.50">
                </div>
                <div class="form-group">
                    <label>Start Date</label>
                    <input type="date" id="staff-start-date" class="form-control">
                </div>
                <div class="d-flex gap-10 mt-20">
                    <button id="save-staff" class="btn">Save Staff</button>
                    <button id="cancel-staff" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add/Edit Menu Item Modal -->
    <div id="menu-item-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="menu-modal-title">Add Menu Item</h3>
                <button class="close-modal" id="close-menu-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Item Name</label>
                    <input type="text" id="menu-item-name" class="form-control">
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select id="menu-item-category" class="form-control">
                        <option value="Fish">Fish</option>
                        <option value="Sausages">Sausages</option>
                        <option value="Pies">Pies</option>
                        <option value="Burgers">Burgers</option>
                        <option value="Sides">Sides</option>
                        <option value="BBQ Chicken">BBQ Chicken</option>
                        <option value="Specials">Specials</option>
                        <option value="Extras">Extras</option>
                        <option value="Drinks">Drinks</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Price (£)</label>
                    <input type="number" id="menu-item-price" class="form-control" step="0.01" min="0" value="0.00">
                </div>
                <div class="form-group">
                    <label>Cost (£)</label>
                    <input type="number" id="menu-item-cost" class="form-control" step="0.01" min="0" value="0.00">
                </div>
                <div class="form-group">
                    <label>Default Cooking Time (Minutes)</label>
                    <input type="number" id="menu-item-cook-time" class="form-control" min="1" max="60" value="10">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="menu-item-description" class="form-control" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="menu-item-status" class="form-control">
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
                <div class="d-flex gap-10 mt-20">
                    <button id="save-menu-item" class="btn">Save Menu Item</button>
                    <button id="cancel-menu-item" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Import CSV Modal -->
    <div id="import-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Import CSV Data</h3>
                <button class="close-modal" id="close-import-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Select CSV File</label>
                    <input type="file" id="csv-file" class="form-control" accept=".csv">
                </div>
                <div class="form-group">
                    <label>Data Type</label>
                    <select id="import-type" class="form-control">
                        <option value="orders">Orders</option>
                        <option value="staff">Staff</option>
                        <option value="attendance">Attendance</option>
                        <option value="menu">Menu Items</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Import Mode</label>
                    <select id="import-mode" class="form-control">
                        <option value="add">Add New Records Only</option>
                        <option value="replace">Replace All Records</option>
                        <option value="update">Update Existing Records</option>
                    </select>
                </div>
                <div class="d-flex gap-10 mt-20">
                    <button id="confirm-import" class="btn btn-success">Import Data</button>
                    <button id="cancel-import" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Kitchen Settings Modal -->
    <div id="kitchen-settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Kitchen Display Settings</h3>
                <button class="close-modal" id="close-kitchen-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Kitchen Display Mode</label>
                    <select id="kitchen-display-mode" class="form-control">
                        <option value="all">Show All Orders</option>
                        <option value="preparing">Show Only Preparing Orders</option>
                        <option value="urgent">Show Only Urgent Orders</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Auto-Complete Orders After (Minutes)</label>
                    <input type="number" id="auto-complete-time" class="form-control" value="10" min="1" max="60">
                </div>
                <div class="form-group">
                    <label>Display Columns</label>
                    <div>
                        <input type="checkbox" id="col-order-id" checked> <label for="col-order-id">Order ID</label><br>
                        <input type="checkbox" id="col-customer" checked> <label for="col-customer">Customer Name</label><br>
                        <input type="checkbox" id="col-items" checked> <label for="col-items">Items</label><br>
                        <input type="checkbox" id="col-timer" checked> <label for="col-timer">Timer</label><br>
                        <input type="checkbox" id="col-notes" checked> <label for="col-notes">Notes</label>
                    </div>
                </div>
                <div class="d-flex gap-10 mt-20">
                    <button id="save-kitchen-display-settings" class="btn">Save Settings</button>
                    <button id="cancel-kitchen-settings" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Configuration Modal -->
    <div id="firebase-config-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Firebase Configuration Required</h3>
                <button class="close-modal" id="close-firebase-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 20px;">To use cloud storage, you need to set up Firebase:</p>
                
                <div style="background-color: var(--black); padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <h4 style="color: var(--white); margin-bottom: 10px;">Quick Setup Steps:</h4>
                    <ol style="color: var(--light-gray); padding-left: 20px;">
                        <li>Go to <a href="https://console.firebase.google.com" target="_blank" style="color: var(--info);">Firebase Console</a></li>
                        <li>Create a new project called "FishHub"</li>
                        <li>Add a web app to your project</li>
                        <li>Enable Authentication → Email/Password</li>
                        <li>Create Realtime Database (start in test mode)</li>
                        <li>Add user: stfishhub@gmail.com, password: password</li>
                        <li>Update security rules (allow authenticated access)</li>
                    </ol>
                </div>
                
                <div class="form-group">
                    <label>Database URL (from Firebase Console)</label>
                    <input type="text" id="db-url" class="form-control" placeholder="https://your-project-id.firebaseio.com">
                </div>
                
                <div class="d-flex gap-10 mt-20">
                    <button id="save-firebase-config" class="btn btn-success">Save Configuration</button>
                    <button id="skip-firebase" class="btn btn-secondary">Use Offline Mode</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // ==================== FIREBASE CONFIGURATION ====================
        
        // Default Firebase configuration (using YOUR provided config)
        let firebaseConfig = {
            apiKey: "AIzaSyD1v90S_vkiS0CyZYs9Xmwsi5N_G5Nw7JQ",
            authDomain: "fishhub-5df1e.firebaseapp.com",
            projectId: "fishhub-5df1e",
            storageBucket: "fishhub-5df1e.firebasestorage.app",
            messagingSenderId: "360759181280",
            appId: "1:360759181280:web:0b730ac1d442546b393585",
            measurementId: "G-SF2WNZQF6D"
        };
        
        // Firebase modules
        let firebaseApp = null;
        let firebaseAuth = null;
        let firebaseDatabase = null;
        let firebaseAnalytics = null;
        
        // Global variables
        let currentUser = null;
        let orders = [];
        let staff = [];
        let attendance = [];
        let menuItems = [];
        let settings = {};
        let kitchenSettings = {};
        let selectedOrderItems = [];
        let autoRefreshIntervals = {};
        let soundEnabled = true;
        let cookingTimers = {};
        let orderTimers = {};
        let firebaseInitialized = false;
        let onlineStatus = true;
        
        // ==================== FIREBASE INITIALIZATION ====================
        
        async function initializeFirebase() {
            try {
                // Import Firebase modules
                const { initializeApp } = await import("https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js");
                const { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } = await import("https://www.gstatic.com/firebasejs/10.11.1/firebase-auth.js");
                const { getDatabase, ref, set, get, update, remove, onValue, push } = await import("https://www.gstatic.com/firebasejs/10.11.1/firebase-database.js");
                const { getAnalytics } = await import("https://www.gstatic.com/firebasejs/10.11.1/firebase-analytics.js");
                
                // Check if database URL is saved in localStorage
                const savedDbUrl = localStorage.getItem('fishbar_db_url');
                if (savedDbUrl) {
                    firebaseConfig.databaseURL = savedDbUrl;
                } else {
                    // Try to infer database URL from projectId
                    firebaseConfig.databaseURL = `https://${firebaseConfig.projectId}-default-rtdb.firebaseio.com`;
                }
                
                // Initialize Firebase
                firebaseApp = initializeApp(firebaseConfig);
                firebaseAuth = getAuth(firebaseApp);
                firebaseDatabase = getDatabase(firebaseApp);
                firebaseAnalytics = getAnalytics(firebaseApp);
                
                console.log("Firebase initialized successfully");
                firebaseInitialized = true;
                
                // Setup auth state listener
                onAuthStateChanged(firebaseAuth, (user) => {
                    if (user) {
                        console.log("User signed in:", user.email);
                        currentUser = user;
                        updateConnectionStatus(true);
                        
                        // Setup real-time data listener
                        setupRealtimeListener();
                    } else {
                        console.log("User signed out");
                        currentUser = null;
                    }
                });
                
                return true;
            } catch (error) {
                console.error("Firebase initialization error:", error);
                firebaseInitialized = false;
                return false;
            }
        }
        
        // ==================== AUTHENTICATION ====================
        
        async function firebaseLogin() {
            const email = "stfishhub@gmail.com";
            const password = "password";
            
            // Check if Firebase is initialized
            if (!firebaseInitialized) {
                const initialized = await initializeFirebase();
                if (!initialized) {
                    showLoginError("Firebase not configured. Using offline mode.");
                    useOfflineMode();
                    return;
                }
            }
            
            try {
                const { signInWithEmailAndPassword } = await import("https://www.gstatic.com/firebasejs/10.11.1/firebase-auth.js");
                const userCredential = await signInWithEmailAndPassword(firebaseAuth, email, password);
                
                console.log("Logged in successfully:", userCredential.user.email);
                currentUser = userCredential.user;
                
                // Save login state
                localStorage.setItem('fishbar_user', JSON.stringify({
                    email: email,
                    loggedIn: true,
                    timestamp: Date.now()
                }));
                
                // Show the main application
                showApp();
                
                // Load data from Firebase
                await loadDataFromFirebase();
                
                // Initialize charts and start auto-refresh
                initializeCharts();
                startAutoRefresh();
                
                updateConnectionStatus(true);
                
            } catch (error) {
                console.error("Login error:", error.code, error.message);
                
                if (error.code === 'auth/user-not-found') {
                    // User doesn't exist, create it
                    await createFirebaseUser(email, password);
                    await firebaseLogin(); // Try logging in again
                } else if (error.code === 'auth/wrong-password') {
                    showLoginError("Incorrect password. Using offline mode.");
                    useOfflineMode();
                } else if (error.code === 'auth/network-request-failed') {
                    showLoginError("Network error. Using offline mode.");
                    useOfflineMode();
                } else {
                    showLoginError(`Error: ${error.message}. Using offline mode.`);
                    useOfflineMode();
                }
            }
        }
        
        async function createFirebaseUser(email, password) {
            try {
                // Note: In a real app, you'd need to use Firebase Admin SDK or create users via console
                // For now, show instructions
                showFirebaseConfigModal();
                return false;
            } catch (error) {
                console.error("Create user error:", error);
                return false;
            }
        }
        
        async function firebaseLogout() {
            try {
                const { signOut } = await import("https://www.gstatic.com/firebasejs/10.11.1/firebase-auth.js");
                await signOut(firebaseAuth);
            } catch (error) {
                console.error("Logout error:", error);
            } finally {
                // Clear local data
                stopAllTimers();
                clearAllIntervals();
                currentUser = null;
                
                // Clear saved user
                localStorage.removeItem('fishbar_user');
                
                // Show login screen
                document.getElementById('login-screen').style.display = 'flex';
                document.getElementById('app').style.display = 'none';
            }
        }
        
        // ==================== DATABASE OPERATIONS ====================
        
        // Get database reference for current user's data
        function getUserDataRef(path = "") {
            if (!currentUser || !currentUser.uid || !firebaseDatabase) {
                return null;
            }
            
            const { ref } = requireFirebaseDatabase();
            const fullPath = `users/${currentUser.uid}/${path}`;
            return ref(firebaseDatabase, fullPath);
        }
        
        // Save data to Firebase
        async function saveDataToFirebase() {
            if (!firebaseInitialized || !currentUser || !currentUser.uid) {
                console.log("Firebase not available, saving to localStorage");
                saveDataToLocalStorage();
                return;
            }
            
            try {
                const { set } = await import("https://www.gstatic.com/firebasejs/10.11.1/firebase-database.js");
                
                const userData = {
                    orders: orders,
                    staff: staff,
                    attendance: attendance,
                    menuItems: menuItems,
                    settings: settings,
                    kitchenSettings: kitchenSettings,
                    lastUpdated: new Date().toISOString()
                };
                
                const userRef = getUserDataRef("");
                if (userRef) {
                    await set(userRef, userData);
                    console.log("Data saved to Firebase successfully");
                    
                    // Also save backup to localStorage
                    saveDataToLocalStorage();
                }
            } catch (error) {
                console.error("Error saving to Firebase:", error);
                updateConnectionStatus(false);
                // Fallback to localStorage
                saveDataToLocalStorage();
            }
        }
        
        // Load data from Firebase
        async function loadDataFromFirebase() {
            if (!firebaseInitialized || !currentUser || !currentUser.uid) {
                console.log("Firebase not available, loading from localStorage");
                loadDataFromLocalStorage();
                return;
            }
            
            try {
                const { get } = await import("https://www.gstatic.com/firebasejs/10.11.1/firebase-database.js");
                
                const userRef = getUserDataRef("");
                if (userRef) {
                    const snapshot = await get(userRef);
                    
                    if (snapshot.exists()) {
                        const userData = snapshot.val();
                        
                        // Load data from Firebase
                        orders = userData.orders || [];
                        staff = userData.staff || [];
                        attendance = userData.attendance || [];
                        menuItems = userData.menuItems || getDefaultMenuItems();
                        settings = userData.settings || getDefaultSettings();
                        kitchenSettings = userData.kitchenSettings || getDefaultKitchenSettings();
                        
                        console.log("Data loaded from Firebase successfully");
                        
                        // Update UI
                        updateDashboard();
                        displayOrders();
                        displayStaff();
                        displayAttendance();
                        displayMenuItems();
                        updateKitchenView();
                        loadSettingsToUI();
                        populateMenuButtons();
                        startOrderTimers();
                        
                        // Save backup to localStorage
                        saveDataToLocalStorage();
                        
                    } else {
                        console.log("No data found in Firebase, using defaults");
                        loadDataFromLocalStorage();
                    }
                }
            } catch (error) {
                console.error("Error loading from Firebase:", error);
                updateConnectionStatus(false);
                // Fallback to localStorage
                loadDataFromLocalStorage();
            }
        }
        
        // Real-time data synchronization
        function setupRealtimeListener() {
            if (!firebaseInitialized || !currentUser || !currentUser.uid) return;
            
            const userRef = getUserDataRef("");
            if (userRef) {
                import("https://www.gstatic.com/firebasejs/10.11.1/firebase-database.js")
                    .then(({ onValue }) => {
                        onValue(userRef, (snapshot) => {
                            if (snapshot.exists()) {
                                const userData = snapshot.val();
                                
                                // Check if data is newer than local copy
                                const remoteTimestamp = new Date(userData.lastUpdated || 0);
                                const localTimestamp = new Date(localStorage.getItem('fishbar_lastUpdated') || 0);
                                
                                if (remoteTimestamp > localTimestamp) {
                                    console.log("Newer data detected in Firebase, updating...");
                                    
                                    // Update local data
                                    orders = userData.orders || orders;
                                    staff = userData.staff || staff;
                                    attendance = userData.attendance || attendance;
                                    menuItems = userData.menuItems || menuItems;
                                    settings = userData.settings || settings;
                                    kitchenSettings = userData.kitchenSettings || kitchenSettings;
                                    
                                    // Update UI if the relevant tab is active
                                    if (document.getElementById('dashboard').classList.contains('active')) {
                                        updateDashboard();
                                    }
                                    if (document.getElementById('orders').classList.contains('active')) {
                                        displayOrders();
                                    }
                                    if (document.getElementById('kitchen').classList.contains('active')) {
                                        updateKitchenView();
                                    }
                                    if (document.getElementById('staff').classList.contains('active')) {
                                        displayStaff();
                                    }
                                    
                                    // Save to localStorage as backup
                                    saveDataToLocalStorage();
                                    
                                    // Show notification
                                    showNotification("Data updated from cloud");
                                }
                            }
                        });
                    })
                    .catch(error => {
                        console.error("Error setting up real-time listener:", error);
                    });
            }
        }
        
        // ==================== LOCALSTORAGE FALLBACK ====================
        
        function saveDataToLocalStorage() {
            localStorage.setItem('fishbar_orders', JSON.stringify(orders));
            localStorage.setItem('fishbar_staff', JSON.stringify(staff));
            localStorage.setItem('fishbar_attendance', JSON.stringify(attendance));
            localStorage.setItem('fishbar_menu', JSON.stringify(menuItems));
            localStorage.setItem('fishbar_settings', JSON.stringify(settings));
            localStorage.setItem('fishbar_kitchen_settings', JSON.stringify(kitchenSettings));
            localStorage.setItem('fishbar_cooking_timers', JSON.stringify(cookingTimers));
            localStorage.setItem('fishbar_lastUpdated', new Date().toISOString());
            
            console.log("Data saved to localStorage");
        }
        
        function loadDataFromLocalStorage() {
            const savedOrders = localStorage.getItem('fishbar_orders');
            orders = savedOrders ? JSON.parse(savedOrders) : [];
            
            const savedStaff = localStorage.getItem('fishbar_staff');
            staff = savedStaff ? JSON.parse(savedStaff) : [];
            
            const savedAttendance = localStorage.getItem('fishbar_attendance');
            attendance = savedAttendance ? JSON.parse(savedAttendance) : [];
            
            const savedMenu = localStorage.getItem('fishbar_menu');
            menuItems = savedMenu ? JSON.parse(savedMenu) : getDefaultMenuItems();
            
            const savedSettings = localStorage.getItem('fishbar_settings');
            settings = savedSettings ? JSON.parse(savedSettings) : getDefaultSettings();
            
            const savedKitchenSettings = localStorage.getItem('fishbar_kitchen_settings');
            kitchenSettings = savedKitchenSettings ? JSON.parse(savedKitchenSettings) : getDefaultKitchenSettings();
            
            const savedCookingTimers = localStorage.getItem('fishbar_cooking_timers');
            cookingTimers = savedCookingTimers ? JSON.parse(savedCookingTimers) : {};
            
            // Update UI with loaded data
            updateDashboard();
            displayOrders();
            displayStaff();
            displayAttendance();
            displayMenuItems();
            updateKitchenView();
            loadSettingsToUI();
            populateMenuButtons();
            startOrderTimers();
        }
        
        // ==================== UTILITY FUNCTIONS ====================
        
        function getDefaultMenuItems() {
            return [
                { id: 1, name: "Cod", category: "Fish", price: 7.30, cost: 3.50, cookTime: 8, status: "active", description: "Fresh Atlantic cod in crispy batter" },
                { id: 2, name: "Haddock", category: "Fish", price: 8.30, cost: 4.00, cookTime: 8, status: "active", description: "Premium haddock in golden batter" },
                { id: 3, name: "Rock", category: "Fish", price: 7.80, cost: 3.80, cookTime: 7, status: "active", description: "Fresh rock fish with light crispy batter" },
                { id: 4, name: "Plaice", category: "Fish", price: 7.80, cost: 3.80, cookTime: 6, status: "active", description: "Delicate plaice with a light crispy coating" },
                { id: 5, name: "Skate", category: "Fish", price: 8.80, cost: 4.20, cookTime: 10, status: "active", description: "Tender skate wings with a delicate flavor" },
                { id: 6, name: "Sea Bream", category: "Fish", price: 7.30, cost: 3.50, cookTime: 7, status: "active", description: "Flaky sea bream with a light crispy batter" },
                { id: 7, name: "Sea Bass", category: "Fish", price: 7.50, cost: 3.60, cookTime: 7, status: "active", description: "Delicate sea bass with crispy golden batter" },
                { id: 8, name: "Fish Cake", category: "Fish", price: 2.30, cost: 1.10, cookTime: 5, status: "active", description: "Homemade fish cake with potato and herbs" },
                { id: 9, name: "Chips", category: "Fish", price: 3.00, cost: 0.80, cookTime: 6, status: "active", description: "Freshly cut chips, cooked to perfection" },
                { id: 10, name: "Jumbo Sausage", category: "Sausages", price: 3.00, cost: 1.20, cookTime: 5, status: "active", description: "Large, meaty sausage" },
                { id: 11, name: "Battered Sausage", category: "Sausages", price: 3.30, cost: 1.30, cookTime: 6, status: "active", description: "Sausage coated in crispy golden batter" },
                { id: 12, name: "Saveloy", category: "Sausages", price: 3.00, cost: 1.20, cookTime: 4, status: "active", description: "Traditional red saveloy sausage" },
                { id: 13, name: "Pukka Pie", category: "Pies", price: 3.80, cost: 1.50, cookTime: 12, status: "active", description: "Traditional meat pie with flaky pastry" },
                { id: 14, name: "Chicken & Mushroom Pie", category: "Pies", price: 3.80, cost: 1.50, cookTime: 12, status: "active", description: "Creamy chicken and mushroom filling" },
                { id: 15, name: "Beef & Onion Pie", category: "Pies", price: 3.80, cost: 1.50, cookTime: 12, status: "active", description: "Tender beef with savory onion gravy" },
                { id: 16, name: "Steak & Kidney Pie", category: "Pies", price: 3.80, cost: 1.50, cookTime: 12, status: "active", description: "Classic British steak and kidney pie" },
                { id: 17, name: "Plain Burger", category: "Burgers", price: 3.80, cost: 1.50, cookTime: 8, status: "active", description: "Classic beef burger" },
                { id: 18, name: "Cheese Burger", category: "Burgers", price: 4.00, cost: 1.60, cookTime: 8, status: "active", description: "Beef burger with cheese" },
                { id: 19, name: "Vegetarian Burger", category: "Burgers", price: 3.80, cost: 1.50, cookTime: 6, status: "active", description: "Vegetarian alternative" },
                { id: 20, name: "Mushy Peas", category: "Sides", price: 1.80, cost: 0.50, cookTime: 3, status: "active", description: "Traditional mushy peas" },
                { id: 21, name: "Curry Sauce", category: "Sides", price: 1.80, cost: 0.40, cookTime: 3, status: "active", description: "Traditional curry sauce" },
                { id: 22, name: "Gravy", category: "Sides", price: 1.80, cost: 0.40, cookTime: 3, status: "active", description: "Rich gravy" },
                { id: 23, name: "Onion Rings", category: "Sides", price: 2.40, cost: 0.80, cookTime: 4, status: "active", description: "Crispy battered onion rings" },
                { id: 24, name: "Kids Meal", category: "Specials", price: 7.95, cost: 3.50, cookTime: 10, status: "active", description: "Includes fish, chips, drink and toy" },
                { id: 25, name: "BBQ Chicken Half", category: "BBQ Chicken", price: 5.50, cost: 2.50, cookTime: 15, status: "active", description: "Succulent half BBQ chicken" },
                { id: 26, name: "BBQ Chicken Whole", category: "BBQ Chicken", price: 8.50, cost: 3.80, cookTime: 20, status: "active", description: "Whole BBQ chicken, perfect for sharing" }
            ];
        }
        
        function getDefaultSettings() {
            return {
                businessName: "St. Margaret's Fish Bar",
                businessAddress: "123 Seafood Street, Coastal Town, CT1 2AB",
                businessPhone: "01234 567890",
                businessEmail: "info@stmargaretsfishbar.co.uk",
                taxRate: 20,
                serviceCharge: 0,
                orderPrefix: "SMFB",
                archiveDays: 30,
                dashboardRefreshRate: 30,
                dateFormat: "dd/mm/yyyy",
                timeFormat: "12h"
            };
        }
        
        function getDefaultKitchenSettings() {
            return {
                alertBeforeTime: 5,
                urgentThreshold: 10,
                kitchenRefreshRate: 30,
                enableSound: true,
                defaultCookingTimes: {},
                displayMode: "all",
                autoCompleteTime: 10,
                displayColumns: {
                    orderId: true,
                    customer: true,
                    items: true,
                    timer: true,
                    notes: true
                }
            };
        }
        
        function requireFirebaseDatabase() {
            // This is a placeholder - in real implementation, you'd import
            return {
                ref: () => null,
                set: () => Promise.resolve(),
                get: () => Promise.resolve({ exists: () => false }),
                update: () => Promise.resolve(),
                remove: () => Promise.resolve(),
                onValue: () => {},
                push: () => ({ key: 'temp' })
            };
        }
        
        // ==================== UI FUNCTIONS ====================
        
        function showApp() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            document.getElementById('current-user').textContent = currentUser ? currentUser.email : 'stfishhub@gmail.com';
            updateCurrentDate();
        }
        
        function useOfflineMode() {
            currentUser = { email: "stfishhub@gmail.com", uid: "local-user-offline" };
            localStorage.setItem('fishbar_user', JSON.stringify({
                email: "stfishhub@gmail.com",
                loggedIn: true,
                timestamp: Date.now(),
                offline: true
            }));
            
            showApp();
            loadDataFromLocalStorage();
            initializeCharts();
            startAutoRefresh();
            updateConnectionStatus(false);
        }
        
        function showLoginError(message) {
            const statusDiv = document.getElementById('login-status');
            statusDiv.innerHTML = `<div style="color: var(--warning); background-color: rgba(255, 152, 0, 0.1); padding: 10px; border-radius: 5px; border-left: 3px solid var(--warning);">
                <i class="fas fa-exclamation-triangle"></i> ${message}
            </div>`;
            statusDiv.style.display = 'block';
        }
        
        function showFirebaseConfigModal() {
            document.getElementById('firebase-config-modal').style.display = 'flex';
        }
        
        function updateConnectionStatus(isOnline) {
            onlineStatus = isOnline;
            const statusEl = document.getElementById('connection-status');
            const textEl = statusEl.querySelector('.connection-text');
            
            if (isOnline) {
                statusEl.className = 'connection-status connection-online';
                textEl.textContent = 'Online';
            } else {
                statusEl.className = 'connection-status connection-offline';
                textEl.textContent = 'Offline';
            }
        }
        
        function showNotification(message) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background-color: var(--dark-gray);
                color: var(--white);
                padding: 15px 20px;
                border-radius: 5px;
                border-left: 4px solid var(--success);
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                z-index: 10000;
                animation: slideIn 0.3s ease;
            `;
            
            notification.innerHTML = `<i class="fas fa-info-circle" style="margin-right: 10px;"></i> ${message}`;
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
        
        // ==================== INITIALIZATION ====================
        
        document.addEventListener('DOMContentLoaded', function() {
            // Set current date
            updateCurrentDate();
            
            // Check for existing login
            const savedUser = localStorage.getItem('fishbar_user');
            if (savedUser) {
                try {
                    const userData = JSON.parse(savedUser);
                    if (userData.loggedIn && userData.timestamp > Date.now() - 24*60*60*1000) {
                        // Auto-login
                        if (userData.offline) {
                            useOfflineMode();
                        } else {
                            firebaseLogin();
                        }
                        return;
                    }
                } catch(e) {
                    // Invalid saved data
                }
            }
            
            // Update login button to use Firebase
            document.getElementById('login-btn').addEventListener('click', function(e) {
                e.preventDefault();
                firebaseLogin();
            });
            
            // Offline mode button
            document.getElementById('offline-mode-btn').addEventListener('click', function(e) {
                e.preventDefault();
                useOfflineMode();
            });
            
            // Update logout to use Firebase
            document.getElementById('logout-link').addEventListener('click', function(e) {
                e.preventDefault();
                firebaseLogout();
            });
            
            // Firebase config modal buttons
            document.getElementById('save-firebase-config').addEventListener('click', function() {
                const dbUrl = document.getElementById('db-url').value;
                if (dbUrl) {
                    localStorage.setItem('fishbar_db_url', dbUrl);
                    alert('Database URL saved. Please refresh and try logging in again.');
                }
                document.getElementById('firebase-config-modal').style.display = 'none';
            });
            
            document.getElementById('skip-firebase').addEventListener('click', function() {
                document.getElementById('firebase-config-modal').style.display = 'none';
                useOfflineMode();
            });
            
            document.getElementById('close-firebase-modal').addEventListener('click', function() {
                document.getElementById('firebase-config-modal').style.display = 'none';
            });
            
            // Initialize all other event listeners
            initEventListeners();
            
            // Set sound toggle state
            const savedSoundSetting = localStorage.getItem('fishbar_sound_enabled');
            if (savedSoundSetting !== null) {
                soundEnabled = savedSoundSetting === 'true';
                document.getElementById('sound-toggle').classList.toggle('active', soundEnabled);
            }
        });
        
        // ==================== CORE APPLICATION FUNCTIONS ====================
        // (All your existing functions from the previous implementation)
        
        function updateCurrentDate() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('en-GB', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('current-date').textContent = dateStr;
        }
        
        function saveData() {
            if (firebaseInitialized && currentUser && currentUser.uid) {
                saveDataToFirebase();
            } else {
                saveDataToLocalStorage();
            }
        }
        
        // Initialize charts
        function initializeCharts() {
            // Revenue chart for dashboard
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            
            // Get data for last 7 days
            const days = [];
            const revenueData = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                
                // Get day name
                const dayName = date.toLocaleDateString('en-GB', { weekday: 'short' });
                days.push(dayName);
                
                // Calculate revenue for this day
                const dayOrders = orders.filter(order => order.timestamp.split('T')[0] === dateStr);
                const dayRevenue = dayOrders.reduce((sum, order) => sum + order.total, 0);
                revenueData.push(dayRevenue);
            }
            
            new Chart(revenueCtx, {
                type: 'line',
                data: {
                    labels: days,
                    datasets: [{
                        label: 'Daily Revenue (£)',
                        data: revenueData,
                        backgroundColor: 'rgba(211, 47, 47, 0.2)',
                        borderColor: '#d32f2f',
                        borderWidth: 2,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '£' + value;
                                }
                            }
                        }
                    }
                }
            });
            
            // Sales chart for dashboard
            const salesCtx = document.getElementById('salesChart').getContext('2d');
            
            // Calculate top selling items
            const itemSales = {};
            orders.forEach(order => {
                order.items.forEach(item => {
                    itemSales[item.name] = (itemSales[item.name] || 0) + item.quantity;
                });
            });
            
            // Get top 5 items
            const topItems = Object.entries(itemSales)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            const itemLabels = topItems.map(item => item[0]);
            const itemData = topItems.map(item => item[1]);
            
            new Chart(salesCtx, {
                type: 'doughnut',
                data: {
                    labels: itemLabels,
                    datasets: [{
                        label: 'Items Sold',
                        data: itemData,
                        backgroundColor: [
                            '#d32f2f',
                            '#ff6659',
                            '#b71c1c',
                            '#ff9a3c',
                            '#ffcc80'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }
        
        // ==================== EVENT LISTENERS ====================
        
        function initEventListeners() {
            // Tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Update active tab
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show corresponding content
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(tabId).classList.add('active');
                    
                    // Handle sub-tabs if needed
                    if (tabId === 'orders' || tabId === 'settings') {
                        const firstSubTab = document.querySelector(`#${tabId} .sub-tab.active`);
                        if (firstSubTab) {
                            const subTabId = firstSubTab.getAttribute('data-subtab');
                            showSubTab(tabId, subTabId);
                        }
                    }
                    
                    // Refresh data if needed
                    if (tabId === 'dashboard') {
                        updateDashboard();
                    } else if (tabId === 'orders') {
                        displayOrders();
                    } else if (tabId === 'kitchen') {
                        updateKitchenView();
                    } else if (tabId === 'staff') {
                        displayStaff();
                    } else if (tabId === 'attendance') {
                        displayAttendance();
                    } else if (tabId === 'payroll') {
                        calculatePayroll();
                    } else if (tabId === 'reports') {
                        generateReport();
                    }
                });
            });
            
            // Sub-tab switching for orders
            document.querySelectorAll('.sub-tab').forEach(subTab => {
                subTab.addEventListener('click', function() {
                    const parentTab = this.closest('.tab-content').id;
                    const subTabId = this.getAttribute('data-subtab');
                    
                    // Update active sub-tab
                    this.closest('.sub-tabs').querySelectorAll('.sub-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show corresponding content
                    showSubTab(parentTab, subTabId);
                });
            });
            
            // Close modal buttons
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', function() {
                    this.closest('.modal').style.display = 'none';
                });
            });
            
            // Cancel buttons in modals
            document.getElementById('cancel-staff').addEventListener('click', () => hideModal('staff-modal'));
            document.getElementById('cancel-menu-item').addEventListener('click', () => hideModal('menu-item-modal'));
            document.getElementById('cancel-import').addEventListener('click', () => hideModal('import-modal'));
            document.getElementById('cancel-kitchen-settings').addEventListener('click', () => hideModal('kitchen-settings-modal'));
            
            // Order management
            document.getElementById('submit-order').addEventListener('click', submitOrder);
            document.getElementById('clear-order').addEventListener('click', clearOrderForm);
            document.getElementById('refresh-orders').addEventListener('click', displayOrders);
            document.getElementById('refresh-dashboard').addEventListener('click', updateDashboard);
            document.getElementById('refresh-kitchen').addEventListener('click', updateKitchenView);
            
            // Export/Import buttons
            document.getElementById('export-orders').addEventListener('click', exportOrdersToCSV);
            document.getElementById('import-orders').addEventListener('click', showImportModal);
            document.getElementById('confirm-import').addEventListener('click', importCSV);
            
            // Staff management
            document.getElementById('add-staff-btn').addEventListener('click', showStaffModal);
            document.getElementById('save-staff').addEventListener('click', saveStaffMember);
            
            // Attendance
            document.getElementById('mark-attendance').addEventListener('click', markAttendance);
            
            // Payroll
            document.getElementById('calculate-payroll').addEventListener('click', calculatePayroll);
            document.getElementById('generate-payroll').addEventListener('click', calculatePayroll);
            document.getElementById('export-payroll').addEventListener('click', exportPayrollToCSV);
            
            // Reports
            document.getElementById('generate-report').addEventListener('click', generateReport);
            document.getElementById('export-report').addEventListener('click', exportReportToCSV);
            
            // Settings
            document.getElementById('save-business-settings').addEventListener('click', saveBusinessSettings);
            document.getElementById('save-system-settings').addEventListener('click', saveSystemSettings);
            document.getElementById('save-kitchen-settings').addEventListener('click', saveKitchenSettings);
            document.getElementById('add-menu-item').addEventListener('click', showMenuItemModal);
            document.getElementById('save-menu-item').addEventListener('click', saveMenuItem);
            document.getElementById('kitchen-settings').addEventListener('click', showKitchenSettingsModal);
            document.getElementById('save-kitchen-display-settings').addEventListener('click', saveKitchenDisplaySettings);
            
            // Data management
            document.getElementById('backup-data').addEventListener('click', backupData);
            document.getElementById('restore-data').addEventListener('click', restoreData);
            document.getElementById('clear-all-data').addEventListener('click', clearAllData);
            
            // Filters
            document.getElementById('apply-filters').addEventListener('click', applyOrderFilters);
            document.getElementById('clear-filters').addEventListener('click', clearOrderFilters);
            
            // Pay period selector
            document.getElementById('pay-period').addEventListener('change', function() {
                const isCustom = this.value === 'custom';
                document.getElementById('custom-date-range').style.display = isCustom ? 'block' : 'none';
                document.getElementById('custom-date-range-to').style.display = isCustom ? 'block' : 'none';
            });
            
            // Report period selector
            document.getElementById('report-period').addEventListener('change', function() {
                const isCustom = this.value === 'custom';
                document.getElementById('report-custom-range').style.display = isCustom ? 'block' : 'none';
                document.getElementById('report-custom-range-to').style.display = isCustom ? 'block' : 'none';
            });
            
            // Sound toggle
            document.getElementById('sound-toggle').addEventListener('click', function() {
                soundEnabled = !soundEnabled;
                this.classList.toggle('active', soundEnabled);
                localStorage.setItem('fishbar_sound_enabled', soundEnabled);
            });
            
            // Close modals when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target.classList.contains('modal')) {
                    event.target.style.display = 'none';
                }
            });
        }
        
        // ==================== ALL YOUR EXISTING APPLICATION FUNCTIONS ====================
        // (You would include all your existing functions here: updateDashboard, displayOrders, etc.)
        // For brevity, I'm including a few key ones as examples:
        
        function updateDashboard() {
            const today = new Date().toISOString().split('T')[0];
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = yesterday.toISOString().split('T')[0];
            
            // Calculate today's revenue
            const todayOrders = orders.filter(order => order.timestamp.split('T')[0] === today);
            const todayRevenue = todayOrders.reduce((sum, order) => sum + order.total, 0);
            document.getElementById('today-revenue').textContent = `£${todayRevenue.toFixed(2)}`;
            
            // Calculate yesterday's revenue for comparison
            const yesterdayOrders = orders.filter(order => order.timestamp.split('T')[0] === yesterdayStr);
            const yesterdayRevenue = yesterdayOrders.reduce((sum, order) => sum + order.total, 0);
            const todayTrend = yesterdayRevenue > 0 ? ((todayRevenue - yesterdayRevenue) / yesterdayRevenue * 100).toFixed(1) : 0;
            document.getElementById('today-trend').textContent = `${todayTrend >= 0 ? '+' : ''}${todayTrend}% vs yesterday`;
            document.getElementById('today-trend').className = `trend ${todayTrend >= 0 ? 'up' : 'down'}`;
            
            // Calculate monthly revenue
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            const monthOrders = orders.filter(order => {
                const orderDate = new Date(order.timestamp);
                return orderDate.getMonth() === currentMonth && orderDate.getFullYear() === currentYear;
            });
            const monthRevenue = monthOrders.reduce((sum, order) => sum + order.total, 0);
            document.getElementById('month-revenue').textContent = `£${monthRevenue.toFixed(2)}`;
            
            // ... rest of your dashboard update logic ...
        }
        
        function showSubTab(parentTab, subTabId) {
            // Hide all sub-tab contents in this parent tab
            document.querySelectorAll(`#${parentTab} .sub-tab-content`).forEach(content => {
                content.classList.remove('active');
            });
            
            // Show selected sub-tab content
            document.getElementById(subTabId).classList.add('active');
            
            // Refresh content if needed
            if (subTabId === 'all-orders') {
                displayOrders();
            } else if (subTabId === 'delivery') {
                displayDeliveryOrders();
            } else if (subTabId === 'takeaway') {
                displayTakeawayOrders();
            } else if (subTabId === 'menu-settings') {
                displayMenuItems();
            }
        }
        
        function hideModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }
        
        // ==================== AUTO-REFRESH ====================
        
        function startAutoRefresh() {
            // Clear existing intervals
            clearAllIntervals();
            
            // Dashboard auto-refresh
            const dashboardRate = settings.dashboardRefreshRate || 30;
            autoRefreshIntervals.dashboard = setInterval(() => {
                if (document.getElementById('dashboard').classList.contains('active')) {
                    updateDashboard();
                }
            }, dashboardRate * 1000);
            
            // Kitchen auto-refresh
            const kitchenRate = kitchenSettings.kitchenRefreshRate || 30;
            autoRefreshIntervals.kitchen = setInterval(() => {
                if (document.getElementById('kitchen').classList.contains('active')) {
                    updateKitchenView();
                }
            }, kitchenRate * 1000);
            
            // Update current date every minute
            autoRefreshIntervals.date = setInterval(updateCurrentDate, 60000);
        }
        
        function clearAllIntervals() {
            for (const key in autoRefreshIntervals) {
                clearInterval(autoRefreshIntervals[key]);
            }
            autoRefreshIntervals = {};
        }
        
        function stopAllTimers() {
            // Stop all order timers
            for (const orderId in orderTimers) {
                clearInterval(orderTimers[orderId]);
            }
            orderTimers = {};
        }
        
        // ... Include all your other existing functions here ...
        // These would be: submitOrder, displayOrders, populateMenuButtons, etc.
        // Since they're quite extensive, I've included the Firebase-specific parts
        // and you can add the rest of your application logic
        
    </script>
    
    <script>
        // ==================== NON-MODULE COMPATIBILITY SCRIPT ====================
        // This ensures the app works even if module imports fail
        
        // Check if Firebase was initialized successfully
        setTimeout(() => {
            if (!window.firebaseApp) {
                console.log("Firebase module loading may have failed, checking for fallback...");
                
                // Show a message to the user
                if (document.getElementById('login-status')) {
                    document.getElementById('login-status').innerHTML = `
                        <div style="color: var(--info); background-color: rgba(33, 150, 243, 0.1); padding: 10px; border-radius: 5px; border-left: 3px solid var(--info); margin-top: 10px;">
                            <i class="fas fa-info-circle"></i> Using compatibility mode. For full cloud features, ensure you have internet connection.
                        </div>
                    `;
                    document.getElementById('login-status').style.display = 'block';
                }
            }
        }, 3000);
        
        // Add CSS for notifications
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
